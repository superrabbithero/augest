"use strict";(self["webpackChunkaugest"]=self["webpackChunkaugest"]||[]).push([[3332],{53332:function(t,e,i){i.r(e),i.d(e,{default:function(){return _}});i(56977);var n=i(19812),a=i(55893),o=i(44220),s=function(t){return(0,n.dD)("data-v-e4b463d4"),t=t(),(0,n.Cn)(),t},r={class:"container"},m={class:"button-groups"},c={class:"button-item"},u=s((function(){return(0,n._)("label",null,"显示网格：",-1)})),l={class:"button-item"},h=s((function(){return(0,n._)("label",null,"动画控制：",-1)})),p={class:"button-item"},d=s((function(){return(0,n._)("label",null,"测试方法的按钮：",-1)})),v={class:"button-item"},f=s((function(){return(0,n._)("label",null,"方向：",-1)})),g={class:"dir-contorl"},b={style:{"margin-bottom":"10px"}},w={class:"button-item log"};function M(t,e,i,s,M,j){var y=(0,n.up)("svg-icon");return(0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("canvas",{ref:"mainCanvas",width:"720",height:"480",class:(0,a.C_)({"game-canvas":!0,gridsytle:M.showGrid})},null,2),(0,n._)("div",m,[(0,n._)("div",c,[u,(0,n.wy)((0,n._)("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=function(t){return M.showGrid=t})},null,512),[[o.e8,M.showGrid]])]),(0,n._)("div",l,[h,(0,n._)("button",{class:"fill",onClick:e[1]||(e[1]=function(){return j.startAnimate&&j.startAnimate.apply(j,arguments)})},"开始"),(0,n._)("button",{class:"fill",onClick:e[2]||(e[2]=function(){return j.stopAnimate&&j.stopAnimate.apply(j,arguments)})},"停止")]),(0,n._)("div",p,[d,(0,n._)("button",{class:"fill",onClick:e[3]||(e[3]=function(){return j.addPopo&&j.addPopo.apply(j,arguments)})},"加兔子"),(0,n._)("button",{class:"fill",onClick:e[4]||(e[4]=function(){return j.addPigCoin&&j.addPigCoin.apply(j,arguments)})},"加一个硬币")]),(0,n._)("div",v,[f,(0,n._)("div",g,[(0,n._)("div",b,[(0,n._)("button",{onClick:e[5]||(e[5]=function(){return j.startJump&&j.startJump.apply(j,arguments)})},[(0,n.Wm)(y,{name:"arrow-up"})])]),(0,n._)("div",null,[(0,n._)("button",{onPointerdown:e[6]||(e[6]=function(t){return j.startMove(-1)}),onPointerup:e[7]||(e[7]=function(){return j.stopMove&&j.stopMove.apply(j,arguments)}),onPointerleave:e[8]||(e[8]=function(){return j.stopMove&&j.stopMove.apply(j,arguments)})},[(0,n.Wm)(y,{name:"arrow-left"})],32),(0,n._)("button",null,[(0,n.Wm)(y,{name:"arrow-down"})]),(0,n._)("button",{onPointerdown:e[9]||(e[9]=function(t){return j.startMove(1)}),onPointerup:e[10]||(e[10]=function(){return j.stopMove&&j.stopMove.apply(j,arguments)}),onPointerleave:e[11]||(e[11]=function(){return j.stopMove&&j.stopMove.apply(j,arguments)})},[(0,n.Wm)(y,{name:"arrow-right"})],32)])])]),(0,n._)("div",w," 速度："+(0,a.zw)(Math.abs(M.moveV.toFixed(2)))+" log:"+(0,a.zw)(M.log),1)])])}var j=i(80543),y=i(81448),x=(i(51532),i(41539),i(78783),i(33948),i(68309),i(54747),i(92222),i(47042),i(60285),i(41637),i(46229),i(17330),i(62062),i(74916),i(4723),i(57658),{data:function(){return{showGrid:!0,mainGameData:[],animateId:0,maincanvas:null,ctx:null,srcMap:{},objectMap:{},srcPath:"@/assets/game-img/test/",startX:null,startY:null,jumpTime:null,moveTime:null,moveV:0,moveDir:0,idleFrames:{},currentIdleFrame:0,lastIdleFrameTime:0,idleFrameDuration:100,IdleIndexFlag:!1,log:"",objectNewId:0}},created:function(){this.objectMap=new Map,this.srcMap=new Map,this.idleFrames=new Map,this.loadAllIdleFrames()},mounted:function(){this.init(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)},unmounted:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)},methods:{test:function(){this.pushObject("user","drawing.svg",{x:50,y:320},"paopao"),this.pushObject("coin1","drawing.svg",{x:50,y:50},"pigcoin")},addPopo:function(){this.pushObject("user","drawing.svg",{x:50,y:320},"paopao")},addPigCoin:function(){var t="coin"+this.objectNewId++;this.log=t,this.pushObject(t,"drawing.svg",{x:50*this.objectNewId%600,y:50},"pigcoin")},handleKeyDown:function(t){switch(console.log("down:".concat(t.key)),t.key){case" ":this.startJump();break;case"ArrowRight":1!=this.moveDir&&this.startMove(1);break;case"ArrowLeft":-1!=this.moveDir&&this.startMove(-1);break}},handleKeyUp:function(t){switch(console.log("up:".concat(t.key)),t.key){case"ArrowRight":this.stopMove();break;case"ArrowLeft":this.stopMove();break}},init:function(){this.maincanvas=this.$refs.mainCanvas,this.ctx=this.maincanvas.getContext("2d"),this.ctx.lineWidth=1},startMove:function(t){this.moveTime=(new Date).getTime(),this.moveDir=t,console.log(this.moveTime,this.moveDir)},stopMove:function(){this.moveDir=0,console.log(this.moveTime,this.moveDir)},move:function(){var t=this.jumpTime?0:.05,e=this.jumpTime?.001:.01,i=5;if(this.moveTime){var n=((new Date).getTime()-this.moveTime)/100;if(this.moveDir>0){this.moveV=this.moveV+this.moveDir*(t-e)*n,this.moveV=Math.min(this.moveV,i);var a=this.objectMap.get("user");a.position.x+=this.moveV,this.objectMap.set("user",a)}else if(this.moveDir<0){this.moveV=this.moveV+this.moveDir*(t-e)*n,this.moveV=Math.max(this.moveV,-i);var o=this.objectMap.get("user");o.position.x+=this.moveV,this.objectMap.set("user",o)}else if(this.moveV>0)if(this.moveV-=e*n,this.moveV<0)this.moveTime=null,this.moveV=0;else{var s=this.objectMap.get("user");s.position.x+=this.moveV,this.objectMap.set("user",s)}else if(this.moveV+=e*n,this.moveV>0)this.moveTime=null,this.moveV=0;else{var r=this.objectMap.get("user");r.position.x+=this.moveV,this.objectMap.set("user",r)}}},startJump:function(){this.jumpTime||(this.startY=this.objectMap.get("user").position.y,this.jumpTime=(new Date).getTime())},jump:function(){var t=-100,e=10,i=this.objectMap.get("user"),n=this.startY,a=((new Date).getTime()-this.jumpTime)/100,o=n+t*a+e*a*a;o>n?(i.position.y=n,this.objectMap.set("user",i),this.jumpTime=null):(i.position.y=o,this.objectMap.set("user",i))},pushObject:function(t,e,i,n){var a=this;this.srcMap.has(e)?this.objectMap.set(t,{url:e,position:i,animationName:"idle01",animationIndex:0,name:n}):this.getImage(e).then((function(o){a.objectMap.set(t,{url:e,position:i,animationName:"idle01",animationIndex:0,name:n})})).catch((function(t){}))},deleteObject:function(t){this.objectMap.delete(t)},startAnimate:function(){0==this.animateId&&(this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate))},stopAnimate:function(){cancelAnimationFrame(this.animateId),this.animateId=0},updateMainCanvasAnimate:function(t){var e=this,i=this.objectMap.get("user");this.idleFrames.get(i.name)[i.animationName];this.jumpTime&&this.jump(),this.move(),t-this.lastIdleFrameTime>this.idleFrameDuration&&(this.ctx.clearRect(0,0,720,480),this.objectMap.forEach((function(t,i){var n=e.idleFrames.get(t.name)[t.animationName];"paopao"==t.name?e.ctx.drawImage(n[t.animationIndex],t.position.x,t.position.y,160,160):(e.ctx.drawImage(n[t.animationIndex],t.position.x,t.position.y,75,75),e.log="".concat(t.animationIndex,",").concat(n.length)),t.animationIndex=(t.animationIndex+1)%n.length,e.objectMap.set(i,t)})),this.lastIdleFrameTime=t),this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate)},getImage:function(t){var e=this;return(0,y.Z)((0,j.Z)().mark((function n(){var a,o,s,r,m,c,u,l,h,p,d;return(0,j.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("svg"!=t.split(".").slice(-1)[0]){n.next=18;break}return n.next=3,fetch(i(75603)("./".concat(t)));case 3:return a=n.sent,n.next=6,a.text();case 6:o=n.sent,s=(new DOMParser).parseFromString(o,"image/svg+xml"),r=s.querySelector("svg"),m=(new XMLSerializer).serializeToString(r),c=new Blob([m],{type:"image/svg+xml;charset=utf-8"}),u=URL.createObjectURL(c),l=new Image,h=e,l.onload=function(){h.srcMap.set(t,l),URL.revokeObjectURL(u)},l.src=u,n.next=22;break;case 18:p=new Image,d=e,p.onload=function(){d.srcMap.set(t,p)},p.src=i(75603)("./".concat(t));case 22:case"end":return n.stop()}}),n)})))()},loadAllIdleFrames:function(t){var e=this,n=i(26329);n.keys().forEach((function(t){var i=t.match(/\.\/([^/]+)\/([^/]+)\/.+\.png$/);if(i){var a=i[1],o=i[2];e.idleFrames.has(a)||e.idleFrames.set(a,{});var s=e.idleFrames.get(a);s[o]||(s[o]=[]);var r=new Image;r.onload=function(){s[o].push(r)},r.src=n(t),e.idleFrames.set(a,s)}})),t&&t()}}}),I=i(48998);const k=(0,I.Z)(x,[["render",M],["__scopeId","data-v-e4b463d4"]]);var _=k}}]);
//# sourceMappingURL=3332-legacy.6ca2a7d2.js.map