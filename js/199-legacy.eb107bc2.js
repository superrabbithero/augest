(self["webpackChunkaugest"]=self["webpackChunkaugest"]||[]).push([[199],{18566:function(t,e,i){var s,n,o,r=i(85267)["default"];i(71550),i(21703),i(47042),i(57658),i(40561),i(74916),i(4723),i(68309),i(41539),i(54747),i(82472),i(48675),i(92990),i(18927),i(33105),i(35035),i(74345),i(7174),i(63408),i(14590),i(32846),i(44731),i(65010),i(96319),i(58867),i(37789),i(33739),i(29368),i(14483),i(12056),i(3462),i(30678),i(27462),i(33824),i(55021),i(12974),i(1439),i(87585),i(15016),i(55315),i(82481),function(i){"object"===r(e)?t.exports=i():(n=[],s=i,o="function"===typeof s?s.apply(e,n):s,void 0===o||(t.exports=o))}((function(){return function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var l=void 0;if(!a&&l)return require(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[r]={exports:{}};e[r][0].call(c.exports,(function(t){var i=e[r][1][t];return n(i||t)}),c,c.exports,t,e,i,s)}return i[r].exports}for(var o=void 0,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"===typeof t}function o(t){return"number"===typeof t}function a(t){return"object"===r(t)&&null!==t}function l(t){return void 0===t}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,i,s,o,r,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(i=this._events[t],l(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(a(i))for(o=Array.prototype.slice.call(arguments,1),h=i.slice(),s=h.length,r=0;r<s;r++)h[r].apply(this,o);return!0},s.prototype.addListener=function(t,e){var i;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(i=l(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"===typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function s(){this.removeListener(t,s),i||(i=!0,e.apply(this,arguments))}return s.listener=e,this.on(t,s),this},s.prototype.removeListener=function(t,e){var i,s,o,r;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,s=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(i)){for(r=o;r-- >0;)if(i[r]===e||i[r].listener&&i[r].listener===e){s=r;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],n(i))this.removeListener(t,i);else if(i)while(i.length)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[],e},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,i){var s,n,o,r,a;a=navigator.userAgent.toLowerCase(),r=navigator.platform.toLowerCase(),s=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],o="ie"===s[1]&&document.documentMode,n={name:"version"===s[1]?s[3]:s[1],version:o||parseFloat("opera"===s[1]&&s[4]?s[4]:s[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||r.match(/mac|win|linux/)||["other"])[0]}},n[n.name]=!0,n[n.name+parseInt(n.version,10)]=!0,n.platform[n.platform.name]=!0,e.exports=n},{}],3:[function(t,e,i){var s,n,o,r=function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);function s(){this.constructor=t}return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t},a={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},h=[].slice;s=t("events").EventEmitter,o=t("./browser.coffee"),n=function(t){var e,i;function s(t){var i,s,n;for(s in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)n=e[s],null==(i=this.options)[s]&&(i[s]=n)}return r(s,t),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},i={delay:500,copy:!1},s.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},s.prototype.setOptions=function(t){var e,i,s;for(e in i=[],t)a.call(t,e)&&(s=t[e],i.push(this.setOption(e,s)));return i},s.prototype.addFrame=function(t,e){var s,n;for(n in null==e&&(e={}),s={},s.transparent=this.options.transparent,i)s[n]=e[n]||i[n];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!==typeof ImageData&&null!==ImageData&&t instanceof ImageData)s.data=t.data;else if("undefined"!==typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?s.data=this.getContextData(t):s.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?s.data=this.getImageData(t):s.image=t}return this.frames.push(s)},s.prototype.render=function(){var t,e,i;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,i;for(i=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)i.push(null);return i}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,i=e;0<=i?t<i:t>i;0<=i?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){var t;while(1){if(t=this.activeWorkers.shift(),null==t)break;this.log("killing active worker"),t.terminate()}return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var t,e,i;return t=Math.min(this.options.workers,this.frames.length),function(){i=[];for(var s=e=this.freeWorkers.length;e<=t?s<t:s>t;e<=t?s++:s--)i.push(s);return i}.apply(this).forEach(function(t){return function(e){var i;return t.log("spawning worker "+e),i=new Worker(t.options.workerScript),i.onmessage=function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)},t.freeWorkers.push(i)}}(this)),t},s.prototype.frameFinished=function(t){var e,i;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,i=this.freeWorkers.length;1<=i?e<i:e>i;1<=i?++e:--e)this.renderNextFrame();return l.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var t,e,i,s,n,o,r,a,l,h,c,d,u,f,g,p;for(a=0,f=this.imageParts,n=0,l=f.length;n<l;n++)e=f[n],a+=(e.data.length-1)*e.pageSize+e.cursor;for(a+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),t=new Uint8Array(a),d=0,g=this.imageParts,o=0,h=g.length;o<h;o++)for(e=g[o],p=e.data,i=r=0,c=p.length;r<c;i=++r)u=p[i],t.set(u,d),i===e.data.length-1?d+=e.cursor:d+=e.pageSize;return s=new Blob([t],{type:"image/gif"}),this.emit("finished",s,t)},s.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e)},s.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d"),e.setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},s.prototype.getTask=function(t){var e,i;if(e=this.frames.indexOf(t),i={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===o.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},s.prototype.log=function(){var t;if(t=1<=arguments.length?h.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},s}(s),e.exports=n},{"./browser.coffee":2,events:1}]},{},[3])(3)}))},74903:function(t,e,i){"use strict";i.d(e,{Z:function(){return f}});var s=i(19812),n=i(55893),o=function(t){return(0,s.dD)("data-v-548b4f26"),t=t(),(0,s.Cn)(),t},r=o((function(){return(0,s._)("div",{class:"draged-bar-handle"},null,-1)})),a=[r],l={class:"modal-slot"};function h(t,e,i,o,r,h){return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)({"au-draged":!0,dragging:r.dragedel,row:1==r.style||3==r.style}),ref:"modal"},[(0,s._)("div",{class:(0,n.C_)({"draged-bar":!0,draged:i.dragable}),onPointerdown:e[0]||(e[0]=function(t){return h.dragdown(t)}),onPointerup:e[1]||(e[1]=function(){return h.dragup&&h.dragup.apply(h,arguments)})},a,34),(0,s._)("div",l,[(0,s.WI)(t.$slots,"default",{},void 0,!0)])],2)}var c={props:{modalKey:{type:String,required:!0},dragable:{type:Boolean,required:!1,default:!0},modeless:{type:Boolean,required:!1,default:!0}},data:function(){return{draged:!1,dragedel:null,disx:0,disy:0,left:0,top:0,style:0}},methods:{dragdown:function(t){this.dragable&&(this.dragedel=this.$refs.modal,this.disx=t.pageX-this.dragedel.offsetLeft,this.disy=t.pageY-this.dragedel.offsetTop,document.addEventListener("pointermove",this.dragmove))},dragup:function(){this.top<50&&(this.dragedel.style.top="0px",this.style=1),this.left<50&&(this.dragedel.style.left="0px",this.style=4);var t=this.dragedel.parentElement.clientWidth-this.dragedel.clientWidth,e=this.dragedel.parentElement.clientHeight-this.dragedel.clientHeight;this.top>e-50&&(this.dragedel.style.top="unset",this.dragedel.style.bottom="0",this.style=3),this.left>t-50&&(this.dragedel.style.left="unset",this.dragedel.style.right="0",this.style=2),this.dragedel=null,document.removeEventListener("pointermove",this.dragmove)},dragmove:function(t){this.dragedel&&(this.dragedel.style.bottom="unset",this.dragedel.style.right="unset",this.left=t.pageX-this.disx,this.top=t.pageY-this.disy,this.dragedel.style.left=this.left+"px",this.dragedel.style.top=this.top+"px")}}},d=i(48998);const u=(0,d.Z)(c,[["render",h],["__scopeId","data-v-548b4f26"]]);var f=u},79241:function(t,e,i){"use strict";i.d(e,{Z:function(){return d}});var s=i(19812),n=i(55893),o={class:"select-box",ref:"selectBox"},r=["onClick"];function a(t,e,i,a,l,h){var c=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("div",o,[(0,s._)("div",{class:(0,n.C_)({"input-area":!0,active:l.selectShow}),onClick:e[0]||(e[0]=function(){return h.openSelect&&h.openSelect.apply(h,arguments)})},[(0,s.Uk)((0,n.zw)(i.dataList[l.currIndex])+" ",1),(0,s.Wm)(c,{name:"arrow-down",size:"16",class:(0,n.C_)({icon:!0,show:l.selectShow})},null,8,["class"])],2),(0,s._)("div",{class:(0,n.C_)({"select-item-group":!0,show:l.selectShow}),ref:"options"},[(0,s._)("div",{class:(0,n.C_)({options:!0,show:l.selectShow})},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.dataList,(function(t,e){return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)({"select-item":!0,active:e==l.currIndex}),onClick:function(t){return h.changeIndex(e)}},(0,n.zw)(t),11,r)})),256))],2)],2)],512)}var l={props:{dataList:{type:Array,required:!0}},data:function(){return{selectShow:!1,currIndex:0}},mounted:function(){},unmounted:function(){document.removeEventListener("click",this.closeSelect)},methods:{openSelect:function(){this.selectShow?(this.selectShow=!1,document.removeEventListener("click",this.closeSelect)):(this.selectShow=!0,document.addEventListener("click",this.closeSelect))},closeSelect:function(){this.$refs.selectBox.contains(event.target)||(this.selectShow=!1,document.removeEventListener("click",this.closeSelect))},changeIndex:function(t){this.currIndex=t,this.selectShow=!1,document.removeEventListener("click",this.closeSelect),this.$emit("change",this.currIndex)}}},h=i(48998);const c=(0,h.Z)(l,[["render",a],["__scopeId","data-v-2ee630a8"]]);var d=c},70199:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return st}});var s=i(19812),n=i(44220),o=i(55893),r=function(t){return(0,s.dD)("data-v-d72f48ea"),t=t(),(0,s.Cn)(),t},a={class:"center-h"},l=r((function(){return(0,s._)("label",null,"画布大小：",-1)})),h={class:"size"},c=r((function(){return(0,s._)("span",null,"x",-1)})),d={class:"center-h",style:{"align-items":"flex-end"}},u=r((function(){return(0,s._)("label",null,"画布预设：",-1)})),f=["onClick"],g=r((function(){return(0,s._)("sup",null,"2",-1)})),p={class:"center-h"},v=r((function(){return(0,s._)("label",null,"网格大小:",-1)})),m={class:"center-h"},w=r((function(){return(0,s._)("label",null,"导出网格大小:",-1)})),x={class:"center-h left"},y={class:"tool-setting-bar"},C={class:"left"},S={class:"tool-option"},_={class:"label",style:{width:"91px"}},I={class:"right"},D={class:"icon-item"},z={class:"size"},k=r((function(){return(0,s._)("span",null,"x",-1)})),b={class:"icon-item"},L={class:"work-area"},R={style:{display:"flex","flex-grow":"1",overflow:"hidden"}},P={class:"tools-bar"},M={class:"tool-item-fullscreen"},F={style:{position:"absolute",left:"1rem"}},A=["width","height"],E={class:"right"},T=["width","height"],W={class:"overview-tools"},$={class:"color-item draged",ref:"dragedColor"},V=["onPointerdown","onPointerup"],U={class:"color-item"},B={class:"color-tools"},H={class:"gif-tools",style:{"justify-content":"center"}},O={class:"gif-tools",style:{height:"80px"}},N=["width","onClick"];function j(t,e,i,r,j,Z){var G=(0,s.up)("my-model"),q=(0,s.up)("svg-icon"),Y=(0,s.up)("auDraged"),K=(0,s.up)("au-select");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(G,{show:j.modal_show.newFileModalShow,modeless:!1,modalKey:"newFileModalShow"},{default:(0,s.w5)((function(){return[(0,s._)("div",a,[l,(0,s._)("div",h,[(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=function(t){return j.newFileForm.rows=t})},null,512),[[n.nr,j.newFileForm.rows]]),c,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=function(t){return j.newFileForm.cols=t})},null,512),[[n.nr,j.newFileForm.cols]])])]),(0,s._)("div",d,[u,((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)([64,32,16,13,11],(function(t){return(0,s._)("div",{onClick:function(e){return j.newFileForm.rows=t,j.newFileForm.cols=t},style:(0,o.j5)({width:"".concat(t,"px"),height:"".concat(t,"px"),fontSize:"".concat(.5*t,"px"),border:"1px solid var(--fontNormal)",marginRight:"4px",cursor:"pointer"})},[(0,s.Uk)((0,o.zw)(t),1),g],12,f)})),64))]),(0,s._)("div",p,[v,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=function(t){return j.newFileForm.gridSize=t})},null,512),[[n.nr,j.newFileForm.gridSize]])]),(0,s._)("div",m,[w,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=function(t){return j.newFileForm.outputSize=t})},null,512),[[n.nr,j.newFileForm.outputSize]])]),(0,s._)("div",x,[(0,s._)("button",{class:"fill",onClick:e[4]||(e[4]=function(t){return Z.newFile()})},"新 建")])]})),_:1},8,["show"]),(0,s._)("div",y,[(0,s._)("div",C,[(0,s._)("div",{class:"tool-option",onClick:e[5]||(e[5]=function(t){return j.modal_show.newFileModalShow=!0})},[(0,s.Wm)(q,{name:"file-create01"})]),(0,s._)("div",S,[(0,s._)("div",_,"画笔大小("+(0,o.zw)(j.penSize)+"):",1),(0,s.wy)((0,s._)("input",{type:"range",style:{color:"currentColor"},"onUpdate:modelValue":e[6]||(e[6]=function(t){return j.penSize=t}),min:"1",max:"20"},null,512),[[n.nr,j.penSize]])])]),(0,s._)("div",I,[(0,s._)("div",{class:"icon-item",onClick:e[7]||(e[7]=function(t){return j.gifToolsShow=!j.gifToolsShow})},[(0,s.Wm)(q,{name:"file-gif"})]),(0,s._)("div",{class:"icon-item",onClick:e[8]||(e[8]=function(t){return j.toolsShow=!j.toolsShow})},[(0,s.Wm)(q,{name:"phone"})]),(0,s._)("div",{class:"icon-item",onClick:e[9]||(e[9]=function(){return Z.undo&&Z.undo.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"undo01"})]),(0,s._)("div",{class:"icon-item-box",onClick:e[12]||(e[12]=function(t){return Z.dropDown(t,"sizeSettingShow")})},[(0,s._)("div",D,[(0,s.Wm)(q,{name:"canvas01"})]),(0,s._)("div",{class:(0,o.C_)({"size-setting":!0,show:j.dropDownBoxShow.sizeSettingShow})},[(0,s.Uk)(" 画布大小： "),(0,s._)("div",z,[(0,s.wy)((0,s._)("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=function(t){return j.rows=t})},null,512),[[n.nr,j.rows]]),k,(0,s.wy)((0,s._)("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=function(t){return j.cols=t})},null,512),[[n.nr,j.cols]])])],2)]),(0,s._)("div",{class:"icon-item-box",onClick:e[17]||(e[17]=function(t){return Z.dropDown(t,"downloadShow")})},[(0,s._)("div",b,[(0,s.Wm)(q,{name:"download01"})]),(0,s._)("div",{class:(0,o.C_)({"size-setting":!0,show:j.dropDownBoxShow.downloadShow})},[(0,s._)("div",{class:"drop-down-option",onClick:e[13]||(e[13]=function(){return Z.saveAsSvg&&Z.saveAsSvg.apply(Z,arguments)})},"保存成 svg"),(0,s._)("div",{class:"drop-down-option",onClick:e[14]||(e[14]=function(){return Z.copySvgCode&&Z.copySvgCode.apply(Z,arguments)})},"复制 svg 代码"),(0,s._)("div",{class:"drop-down-option",onClick:e[15]||(e[15]=function(){return Z.saveAsPng&&Z.saveAsPng.apply(Z,arguments)})},"保存成 png"),(0,s._)("div",{class:"drop-down-option",onClick:e[16]||(e[16]=function(){return Z.saveAsGif&&Z.saveAsGif.apply(Z,arguments)})},"保存成 gif")],2)])])]),(0,s._)("div",L,[(0,s._)("div",R,[(0,s.Wm)(Y,null,{default:(0,s.w5)((function(){return[(0,s._)("div",P,[(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:1==j.tool}),onClick:e[18]||(e[18]=function(t){return Z.switchTool(1)})},[(0,s.Wm)(q,{name:"pencil",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:2==j.tool}),onClick:e[19]||(e[19]=function(t){return Z.switchTool(2)})},[(0,s.Wm)(q,{name:"eraser",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:3==j.tool}),onClick:e[20]||(e[20]=function(t){return Z.switchTool(3)})},[(0,s.Wm)(q,{name:"line",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:4==j.tool}),onClick:e[21]||(e[21]=function(t){return Z.switchTool(4)})},[(0,s.Wm)(q,{name:"rect",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:5==j.tool}),onClick:e[22]||(e[22]=function(t){return Z.switchTool(5)})},[(0,s.Wm)(q,{name:"circle",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:6==j.tool}),onClick:e[23]||(e[23]=function(t){return Z.switchTool(6)})},[(0,s.Wm)(q,{name:"paintBuckets",className:"tool-item-svg"})],2),(0,s._)("div",{class:(0,o.C_)({"tool-item":!0,active:7==j.tool}),onClick:e[24]||(e[24]=function(t){return Z.switchTool(7)})},[(0,s.Wm)(q,{name:"select",className:"tool-item-svg"})],2),(0,s._)("div",{class:"tool-item",onClick:e[25]||(e[25]=function(){return Z.clearAll&&Z.clearAll.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"delete02",className:"tool-item-svg"})]),(0,s._)("div",{class:"tool-item",onClick:e[27]||(e[27]=function(){return Z.openFileInput&&Z.openFileInput.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"picture-add",className:"tool-item-svg"}),(0,s.wy)((0,s._)("input",{type:"file",id:"fileInput",onChange:e[26]||(e[26]=function(){return Z.importImg&&Z.importImg.apply(Z,arguments)}),accept:"image/*"},null,544),[[n.F8,!1]])]),(0,s._)("div",M,[(0,s._)("div",{class:"color back",style:(0,o.j5)({backgroundColor:j.bkgColor}),onClick:e[28]||(e[28]=function(t){var e;return e=[j.bkgColor,j.currentColor],j.currentColor=e[0],j.bkgColor=e[1],e})},null,4),(0,s._)("div",{class:"color front",style:(0,o.j5)({backgroundColor:j.currentColor})},[(0,s._)("input",{type:"color",class:"colorInput-hidden",ref:"addColor1",onChange:e[29]||(e[29]=function(t){return Z.addColor(t)})},null,544)],4)])])]})),_:1}),(0,s._)("div",{class:"middle",onPointermove:e[31]||(e[31]=function(){return Z.handlePointerMove&&Z.handlePointerMove.apply(Z,arguments)}),onPointerup:e[32]||(e[32]=function(){return Z.handlePointerUp&&Z.handlePointerUp.apply(Z,arguments)}),ref:"realViewport",onWheel:e[33]||(e[33]=function(){return Z.zoomWheel&&Z.zoomWheel.apply(Z,arguments)})},[(0,s._)("div",F,(0,o.zw)(j.coordinate),1),(0,s._)("div",{class:"drawing-area",onPointerdown:e[30]||(e[30]=function(){return Z.handlePointerDown&&Z.handlePointerDown.apply(Z,arguments)})},[(0,s._)("canvas",{width:Z.width,height:Z.height,class:"gridstyle",style:(0,o.j5)(Z.canvasStyle),ref:"canvas"},null,12,A)],32)],544),(0,s.wy)((0,s._)("div",E,[(0,s._)("div",{class:"overview",onPointermove:e[35]||(e[35]=function(){return Z.dragViewportMove&&Z.dragViewportMove.apply(Z,arguments)}),onPointerup:e[36]||(e[36]=function(){return Z.dragViewportUp&&Z.dragViewportUp.apply(Z,arguments)}),onWheel:e[37]||(e[37]=function(){return Z.zoomWheel&&Z.zoomWheel.apply(Z,arguments)})},[(0,s._)("canvas",{class:"gridstyle",ref:"canvas_overview",style:(0,o.j5)(Z.overviewStyle),width:Z.overviewSize.width,height:Z.overviewSize.height},null,12,T),(0,s._)("div",{class:"viewport",ref:"viewport",onPointerdown:e[34]||(e[34]=function(){return Z.dragViewportDown&&Z.dragViewportDown.apply(Z,arguments)})},null,544)],32),(0,s._)("div",W,[(0,s._)("div",{class:"icon-item",onClick:e[38]||(e[38]=function(){return Z.zoomIn&&Z.zoomIn.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"zoomIn11-1"})]),(0,s._)("div",{class:"icon-item",onClick:e[39]||(e[39]=function(){return Z.zoomOut&&Z.zoomOut.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"zoomOut11-1"})]),(0,s.wy)((0,s._)("input",{type:"range",style:{width:"80px",color:"currentColor"},min:"10",max:"100","onUpdate:modelValue":e[40]||(e[40]=function(t){return j.scaleCount=t}),onInput:e[41]||(e[41]=function(){return Z.resizeViewport&&Z.resizeViewport.apply(Z,arguments)})},null,544),[[n.nr,j.scaleCount]]),(0,s._)("div",{class:"icon-item",onClick:e[42]||(e[42]=function(){return Z.zoomFit&&Z.zoomFit.apply(Z,arguments)})},[(0,s.Wm)(q,{name:"zoomFit11-1"})])]),(0,s.Wm)(K,{dataList:["默认","Pixel-8"],onChange:Z.changeMyColor,style:{"margin-bottom":"5px"}},null,8,["onChange"]),(0,s._)("div",{class:"color-tools",ref:"colorTools",onPointermove:e[45]||(e[45]=function(e){return Z.handleMove(e,t.index)})},[(0,s.wy)((0,s._)("div",$,null,512),[[n.F8,null!=j.dragedColorIndex]]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(j.myColors,(function(t,e){return(0,s.wg)(),(0,s.iD)("div",{class:"color-item",ref_for:!0,ref:"colorItem",style:(0,o.j5)({backgroundColor:t}),onPointerdown:function(t){return Z.handleStart(t,e)},onPointerup:function(t){return Z.handleEnd(t,e)}},null,44,V)})),256)),(0,s._)("div",U,[(0,s.Uk)("+ "),(0,s._)("input",{type:"color",class:"colorInput-hidden",ref:"addColor2",onChange:e[43]||(e[43]=function(t){return Z.addColor(t)})},null,544)]),(0,s._)("div",{class:(0,o.C_)({"color-item delete":!0,show:null!=j.dragedColorIndex}),onPointerup:e[44]||(e[44]=function(e){return Z.handleEnd(t.event,-1)})},[(0,s.Wm)(q,{name:"delete02",className:"color-item-svg"})],34)],544),(0,s._)("div",B,[(0,s.Uk)(" 融合阈值："),(0,s.wy)((0,s._)("input",{type:"number",min:"0",max:"100",step:"10","onUpdate:modelValue":e[46]||(e[46]=function(t){return j.threshold=t})},null,512),[[n.nr,j.threshold]]),(0,s._)("button",{onClick:e[47]||(e[47]=function(){return Z.imgToPixel&&Z.imgToPixel.apply(Z,arguments)})},"像素转换"),(0,s._)("button",{onClick:e[48]||(e[48]=function(){return Z.adjustImg&&Z.adjustImg.apply(Z,arguments)})},"像素融合")])],512),[[n.F8,j.toolsShow]])]),(0,s._)("div",{class:(0,o.C_)({"gif-tools-box":!0,show:j.gifToolsShow})},[(0,s._)("div",H,[(0,s.Wm)(q,{class:"gif-tools-item",name:"replay02",onClick:e[49]||(e[49]=function(t){return j.gifImageDataIndex=0,Z.startAnimate()})}),(0,s.Wm)(q,{class:"gif-tools-item",name:"pause01",onClick:Z.stopAnimate},null,8,["onClick"]),(0,s._)("button",{class:"gif-tools-item has-icon-button",onClick:e[50]||(e[50]=function(t){return Z.changeSpeed(1)})},[(0,s.Wm)(q,{style:{"margin-right":"0.5rem"},size:"16",name:"film11-1"}),(0,s.Uk)(" "+(0,o.zw)("".concat(j.animateFps[j.animateFpsIndex],"fps")),1)]),(0,s.Wm)(q,{class:"gif-tools-item",onClick:e[51]||(e[51]=function(t){return Z.pushGifImgList()}),name:"letter-plus01"}),(0,s.Wm)(q,{class:"gif-tools-item",onClick:e[52]||(e[52]=function(t){return Z.deleteGifImgList()}),name:"letter-minus01"}),(0,s._)("button",{class:"gif-tools-item",onClick:e[53]||(e[53]=function(t){return Z.saveGifNPngToFolder(j.gifImageDataList)})},"导出")]),(0,s._)("div",O,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(j.gifImageDataList.length,(function(t){return(0,s.wg)(),(0,s.iD)("canvas",{ref_for:!0,ref:"gifCanvas",width:100*j.cols/j.rows,height:"100",class:(0,o.C_)({gifCanvas:!0,currentGifCanvas:t-1==j.gifImageDataIndex}),onClick:function(e){return Z.putGifImage2MainCanvas(t-1)}},null,10,N)})),256)),(0,s.wy)((0,s._)("div",{class:"addcanvas",onClick:e[54]||(e[54]=function(t){return Z.pushGifImgList()})},"+",512),[[n.F8,0==j.gifImageDataList.length]])])],2)])],64)}var Z=i(80543),G=i(81448),q=i(27222),Y=i(17519),K=(i(92222),i(40561),i(26699),i(32023),i(57658),i(47941),i(41539),i(54747),i(70189),i(78783),i(33948),i(47042),i(51532),i(60285),i(41637),i(46229),i(17330),i(62062),i(9653),i(23157),i(38862),i(18566)),X=i.n(K),J=i(79241),Q=i(74903),tt={data:function(){return{tool:1,rows:11,cols:11,gridSize:100,outputSize:30,coordinate:"x:0,y:0",currentColor:"#000001",bkgColor:"#fff",myColors:["#000001","#ffffff","#F96635","#f9A822","#FAEC86","#93d3a2","#2bbaa5","#008080"],defaultColors:["#000001","#ffffff","#F96635","#f9A822","#FAEC86","#93d3a2","#2bbaa5","#008080"],pix8Colors:["#000001","#ffffff","#202952","#762b52","#398557","#a1573e","#605750","#c4c3c8","#fef1eb","#eb3452","#f1a73c","#fcee5a","#67e055","#57a8f7","#807498","#ee7dab","#f6cdb1"],colorIndex:0,dragedColorIndex:null,isDrawing:!1,pixels:[],endPoints:{x:0,y:0},maincanvas:null,ctx:null,ovCtx:null,historys:[],log:"",shiftdown:!1,dropDownBox:null,dropDownBoxShow:{sizeSettingShow:!1,downloadShow:!1},penSize:1,scaleCount:30,minScaleCount:30,viewport:null,disx:0,disy:0,selectedRect:{x:0,y:0,width:0,height:0},offscreenCanvas:null,selectedImgData:null,selectedBgData:null,isDragingSelectRect:!1,selectRectAnimateId:0,pressTimer:null,toolsShow:!0,modal_show:{newFileModalShow:!1},newFileForm:{cols:13,rows:13,gridSize:100,outputSize:30},gifToolsShow:!1,gifImageDataList:[],animateId:0,gifImageDataIndex:-1,animateStartTime:null,animateFps:[3,4,5,10,30,60],animateFpsIndex:0,animateSpeed:300,imgToPixelTools:!1,threshold:0,imgPointList:[[]]}},components:{auSelect:J.Z,auDraged:Q.Z},computed:{width:function(){return this.cols*this.gridSize},height:function(){return this.rows*this.gridSize},overviewSize:function(){var t=180,e=t/this.cols*this.rows;return e>140&&(e=140,t=e/this.rows*this.cols),{width:t,height:e}},overviewStyle:function(){var t=this.overviewSize.width/this.cols;return{backgroundSize:"".concat(2*t,"px ").concat(2*t,"px"),backgroundPosition:"0 0 , ".concat(t,"px ").concat(t,"px")}},canvasStyle:function(){var t=this.scaleCount/100,e=this.gridSize*t;return{width:"".concat(this.width*t,"px"),height:"".concat(this.height*t,"px"),backgroundSize:"".concat(2*e,"px ").concat(2*e,"px"),backgroundPosition:"0 0 , ".concat(e,"px ").concat(e,"px")}}},mounted:function(){this.init(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),this.$refs.realViewport.addEventListener("scroll",this.viewportScroll)},unmounted:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),this.$refs.realViewport&&this.$refs.realViewport.removeEventListener("scroll",this.viewportScroll),document.removeEventListener("click",this.closeDropDownBox)},methods:{changeMyColor:function(t){0==t?this.myColors=this.defaultColors:1==t&&(this.myColors=this.pix8Colors)},newFile:function(){this.cols=Math.floor(this.newFileForm.cols),this.gridSize=Math.floor(this.newFileForm.gridSize),this.rows=Math.floor(this.newFileForm.rows),this.outputSize=Math.floor(this.newFileForm.outputSize),this.historys=[],this.clearAll(),this.modal_show.newFileModalShow&&(this.modal_show.newFileModalShow=!1)},handleStart:function(t,e){var i=this;this.pressTimer=setTimeout((function(){i.dragedColorIndex=e;var s=t.target;i.disx=t.pageX-s.offsetLeft,i.disy=t.pageY-s.offsetTop;var n=i.$refs.dragedColor;n.style.backgroundColor=i.myColors[i.dragedColorIndex],n.style.left="".concat(t.pageX-i.disx,"px"),n.style.top="".concat(t.pageY-i.disy,"px"),clearTimeout(i.pressTimer),i.pressTimer=null}),500)},handleMove:function(t,e){if(this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null),null!=this.dragedColorIndex){var i=this.$refs.dragedColor;i.style.backgroundColor=this.myColors[this.dragedColorIndex],i.style.left="".concat(t.pageX-this.disx,"px"),i.style.top="".concat(t.pageY-this.disy,"px")}},handleEnd:function(t,e){if(this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null,this.selectColor(e)),null!=this.dragedColorIndex)if(-1==e)this.myColors.splice(this.dragedColorIndex,1),this.dragedColorIndex=null;else{var i=this.myColors[e];this.myColors[e]=this.myColors[this.dragedColorIndex],this.myColors[this.dragedColorIndex]=i,this.dragedColorIndex=null}},selectColor:function(t){this.currentColor=this.myColors[t]},addColor:function(t){var e=t.currentTarget,i=e.value;this.myColors.includes(i)||this.myColors.push(i),this.currentColor=i},switchTool:function(t){this.tool!=t&&(7==this.tool&&(this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.showLastHistory()),7==t&&(this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height)),this.tool=t)},updateOverview:function(){this.ovCtx.clearRect(0,0,this.overviewSize.width,this.overviewSize.height),this.ovCtx.drawImage(this.maincanvas,0,0,this.width,this.height,0,0,this.overviewSize.width,this.overviewSize.height)},dropDown:function(t,e){var i=this;this.dropDownBox=t.target;var s=Object.keys(this.dropDownBoxShow);s.forEach((function(t){i.dropDownBoxShow[t]=!1})),this.dropDownBoxShow[e]=!0,document.addEventListener("click",this.closeDropDownBox)},closeDropDownBox:function(t){var e=this;if(!this.dropDownBox.contains(t.target)){var i=Object.keys(this.dropDownBoxShow);i.forEach((function(t){e.dropDownBoxShow[t]=!1})),document.removeEventListener("click",this.closeDropDownBox)}},handleKeyDown:function(t){"Shift"===t.key&&(this.shiftdown=!0)},handleKeyUp:function(t){"Shift"===t.key&&(this.shiftdown=!1)},init:function(){window.PointerEvent&&(this.log="Pointer events are supported."),this.maincanvas=this.$refs.canvas;var t=this.$refs.canvas_overview;this.ctx=this.maincanvas.getContext("2d"),this.ctx.lineWidth=1,this.ovCtx=t.getContext("2d"),this.addHistory(),this.resizeViewport(),this.getMinScale(),this.scaleCount=this.minScaleCount,this.offscreenCanvas=document.createElement("canvas")},getMinScale:function(){var t=this.$refs.realViewport,e=t.clientWidth-5,i=e/this.cols*this.rows;i>t.clientHeight&&(i=t.clientHeight-2,e=i/this.rows*this.cols),this.minScaleCount=Math.floor(100*e/this.width),this.log=this.minScaleCount},handlePointerDown:function(t){if(this.endPoints=this.getPoint({x:t.clientX,y:t.clientY}),2==this.tool)this.isDrawing=!0,this.clearPixel(this.endPoints);else if(this.tool<6)this.isDrawing=!0,this.drawPixel(this.endPoints);else if(6==this.tool)this.ctx.fillStyle=this.currentColor,this.fillArea(this.endPoints),this.addHistory();else if(7==this.tool){this.ctx.beginPath(),this.ctx.rect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.ctx.closePath();var e=this.ctx.isPointInPath(this.endPoints.x,this.endPoints.y);if(e){if(this.selectedImgData)this.ctx.putImageData(this.selectedBgData,0,0);else{this.showLastHistory(),this.selectedImgData=this.ctx.getImageData(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.offscreenCanvas.width=this.selectedRect.width,this.offscreenCanvas.height=this.selectedRect.height;var i=this.offscreenCanvas.getContext("2d");this.showLastHistory(),this.ctx.clearRect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height),i.putImageData(this.selectedImgData,0,0)}this.disx=this.endPoints.x-this.selectedRect.x,this.disy=this.endPoints.y-this.selectedRect.y,this.isDragingSelectRect=!0,this.ctx.drawImage(this.offscreenCanvas,this.selectedRect.x-1,this.selectedRect.y-1)}else this.showLastHistory(),0==this.selectRectAnimateId&&(this.selectRectAnimateId=requestAnimationFrame(this.dashedRectAnimate)),this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},this.selectedBgData=this.ctx.getImageData(0,0,this.width,this.height),this.isDrawing=!0}},handlePointerMove:function(t){this.ctx.fillStyle=this.currentColor,this.ctx.strokeStyle=this.currentColor;var e=this.getPoint({x:t.clientX,y:t.clientY});this.isDrawing?1==this.tool?(this.drawLine(this.endPoints,e),this.endPoints=e):2==this.tool?this.clearPixel(e):3==this.tool?(this.showLastHistory(),this.drawLine(this.endPoints,e)):4==this.tool?(this.showLastHistory(),this.drawRect(this.endPoints,e)):5==this.tool?(this.showLastHistory(),this.drawPixelEllipse(this.endPoints,e)):7==this.tool&&(this.showLastHistory(),this.select(this.endPoints,e)):7==this.tool&&this.isDragingSelectRect?(this.selectedRect.x=e.x-this.disx,this.selectedRect.y=e.y-this.disy):this.tool<6&&(this.showLastHistory(),this.overMove(e))},select:function(t,e){var i=Math.min(t.x,e.x),s=Math.min(t.y,e.y),n=Math.abs(e.x-t.x)+this.gridSize,o=Math.abs(e.y-t.y)+this.gridSize;this.imgPointList=[[]],this.selectedRect={x:i,y:s,width:n,height:o}},drawDashedRect:function(){this.ctx.lineDashOffset=(this.ctx.lineDashOffset+1)%100,this.ctx.setLineDash([0]),this.ctx.strokeStyle="#fff",this.ctx.strokeRect(this.selectedRect.x-5,this.selectedRect.y-5,this.selectedRect.width+10,this.selectedRect.height+10),this.ctx.setLineDash([50]),this.ctx.strokeStyle="#000",this.ctx.strokeRect(this.selectedRect.x-5,this.selectedRect.y-5,this.selectedRect.width+10,this.selectedRect.height+10),this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.fillRect(this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.ctx.fillStyle=this.currentColor},dashedRectAnimate:function(){this.ctx.putImageData(this.selectedBgData,0,0),this.selectedRect.width*this.selectedRect.height!=0&&this.drawDashedRect(),this.selectedImgData&&this.ctx.drawImage(this.offscreenCanvas,this.selectedRect.x,this.selectedRect.y),this.selectRectAnimateId=requestAnimationFrame(this.dashedRectAnimate)},selectSave:function(){this.ctx.putImageData(this.selectedBgData,0,0),this.ctx.drawImage(this.offscreenCanvas,0,0,this.selectedRect.width,this.selectedRect.height,this.selectedRect.x,this.selectedRect.y,this.selectedRect.width,this.selectedRect.height),this.addHistory()},handlePointerUp:function(){this.isDrawing&&(this.isDrawing=!1,7==this.tool?this.selectedRect.width*this.selectedRect.height==0&&(cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.selectedRect={x:0,y:0,width:0,height:0},this.selectedImgData=null):this.addHistory()),this.isDragingSelectRect&&(this.isDragingSelectRect=!1,this.selectSave())},drawPixel:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.penSize,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentColor;this.ctx.fillStyle=i;var s=t.x/this.gridSize-Math.floor(e/2),n=t.y/this.gridSize-Math.floor(e/2);this.ctx.fillRect(this.gridSize*s,this.gridSize*n,this.gridSize*e,this.gridSize*e)},overMove:function(t){this.ctx.fillStyle="rgba(0,0,0,0.3)";var e=this.penSize,i=t.x/this.gridSize-Math.floor(e/2),s=t.y/this.gridSize-Math.floor(e/2);this.ctx.fillRect(this.gridSize*i,this.gridSize*s,this.gridSize*e,this.gridSize*e)},clearPixel:function(t){var e=this.penSize,i=t.x/this.gridSize-Math.floor(e/2),s=t.y/this.gridSize-Math.floor(e/2);this.ctx.clearRect(this.gridSize*i,this.gridSize*s,this.gridSize*e,this.gridSize*e)},drawLine:function(t,e){var i=t.x,s=t.y,n=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y),r=t.x<e.x?this.gridSize:-this.gridSize,a=t.y<e.y?this.gridSize:-this.gridSize,l=n-o;while(1){if(this.drawPixel({x:i,y:s}),i===e.x&&s===e.y)break;var h=2*l;h>-o&&(l-=o,i+=r),h<n&&(l+=n,s+=a)}},drawRect:function(t,e){var i,s;if(this.shiftdown){var n=e.x-t.x,o=e.y-t.y,r=Math.min(Math.abs(n),Math.abs(o));e=n>0&&o>0?{x:t.x+r,y:t.y+r}:n>0&&o<0?{x:t.x+r,y:t.y-r}:n<0&&o>0?{x:t.x-r,y:t.y+r}:{x:t.x-r,y:t.y-r}}i={x:e.x,y:t.y},s={x:t.x,y:e.y},this.drawLine(t,i),this.drawLine(s,e),this.drawLine(t,s),this.drawLine(i,e)},drawPixelEllipse:function(t,e){var i=(t.x+e.x)/2/this.gridSize+.5,s=Math.abs((e.x-t.x)/this.gridSize/2),n=e.y>t.y?s:-s,o=this.shiftdown?t.y/this.gridSize+n+.5:(t.y+e.y)/2/this.gridSize+.5,r=this.shiftdown?s:Math.abs((e.y-t.y)/this.gridSize/2),a=s%1?.5:0,l=r,h=Math.ceil(r*r-s*s*r+.25*s*s),c=2*r*r*a,d=2*s*s*l;this.drawEllipsePoints(i,o,a,l);while(c<d)a++,c+=2*r*r,h<=0?h+=c+r*r:(l--,d-=2*s*s,h+=c-d+r*r),this.drawEllipsePoints(i,o,a,l);var u=Math.ceil(r*r*(a+.5)*(a+.5)+s*s*(l-1)*(l-1)-s*s*r*r);while(l>0)l--,d-=2*s*s,u<=0?(a++,c+=2*r*r,u+=r*r-d+c):u+=s*s-d,this.drawEllipsePoints(i,o,a,l)},drawEllipsePoints:function(t,e,i,s){t-=.5,e-=.5,this.drawPixel({x:(t+i)*this.gridSize,y:(e-s)*this.gridSize}),this.drawPixel({x:(t-i)*this.gridSize,y:(e-s)*this.gridSize}),this.drawPixel({x:(t-i)*this.gridSize,y:(e+s)*this.gridSize}),this.drawPixel({x:(t+i)*this.gridSize,y:(e+s)*this.gridSize})},fillArea:function(t){var e=this.getColorAtPixel(t),i=this.hexToArgb(this.ctx.fillStyle);if(!this.colorsMatch(e,i)){var s=[t],n=this.$refs.canvas,o=n.width,r=n.height,a=new Set,l=function(t,e){return"".concat(t,",").concat(e)};while(s.length){var h=s.pop(),c=h.x,d=h.y,u=this.getColorAtPixel({x:c,y:d});!a.has(l(c,d))&&this.colorsMatch(u,e)&&(this.drawPixel({x:c,y:d},1),a.add(l(c,d)),c>0&&s.push({x:c-this.gridSize,y:d}),c<o-this.gridSize&&s.push({x:c+this.gridSize,y:d}),d>0&&s.push({x:c,y:d-this.gridSize}),d<r-this.gridSize&&s.push({x:c,y:d+this.gridSize}))}}},getColorAtPixel:function(t){var e=this.ctx.getImageData(t.x,t.y,1,1),i=e.data;return i.slice(0,4)},hexToArgb:function(t){"#"===t[0]&&(t=t.slice(1));var e=parseInt(t,16);return 8===t.length?[e>>24&255,e>>16&255,e>>8&255,255&e]:6===t.length?[255,e>>16&255,e>>8&255,255&e]:4===t.length?[e>>12&255,e>>8&255,e>>4&255,255&e]:3===t.length?[255,e>>8&255,e>>4&255,255&e]:[0,0,0,0]},colorsMatch:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},clearAll:function(){this.selectedRect={x:0,y:0,width:0,height:0},this.selectedImgData=null,this.ctx.clearRect(0,0,this.width,this.height),cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0,this.addHistory()},isRectEqual:function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},getPoint:function(t){var e=this.scaleCount/100,i=this.$refs.canvas.getBoundingClientRect(),s=Math.floor((t.x-i.left)/this.gridSize/e)*this.gridSize,n=Math.floor((t.y-i.top)/this.gridSize/e)*this.gridSize;return this.coordinate="x:".concat(s/this.gridSize,",y:").concat(n/this.gridSize),{x:s,y:n}},showLastHistory:function(){var t=this.historys,e=t[t.length-1]["data"];this.ctx.putImageData(e,0,0)},addHistory:function(){this.historys.push({data:this.ctx.getImageData(0,0,this.width,this.height)}),this.updateOverview(),this.gifImageDataList.length>0&&this.updateGifImage(this.gifImageDataIndex)},undo:function(){var t=this.historys;t&&t.length>1&&(t.pop(),this.showLastHistory(),this.updateOverview()),this.selectedImgData=null,this.selectedRect={x:0,y:0,width:0,height:0},cancelAnimationFrame(this.selectRectAnimateId),this.selectRectAnimateId=0},getPixelVector:function(t){var e=this,i=this.outputSize,s="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"),n={x:t.x,y:t.y},o={x:t.x+i,y:t.y},r={x:t.x+i,y:t.y+i},a={x:t.x,y:t.y+i},l=function(t,i){return t+i*e.cols};return[[l(n.x,n.y),l(o.x,o.y),s],[l(o.x,o.y),l(r.x,r.y),s],[l(r.x,r.y),l(a.x,a.y),s],[l(a.x,a.y),l(n.x,n.y),s]]},getpathContent:function(t){var e=this,i=[],s=new Map;t.forEach((function(t){var i=e.getPixelVector(t);i.forEach((function(t){if(s.has(t[0]))if(s.has(t[1])){for(var e=s.get(t[1]),i=null,n=0;n<e.length;n++)if(e[n][0]==t[0]&&e[n][1]==t[2]){i=e.splice(n,1),e.length>0?s.set(t[1],e):s.delete(t[1]);break}if(null==i){var o=s.get(t[0]).push([t[1],t[2]]);s[(t[0],o)]}}else{var r=s.get(t[0]).push([t[1],t[2]]);s[(t[0],r)]}else s.set(t[0],[[t[1],t[2]]])}))}));var n=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(console.log("findPath(\n".concat(e,",\n").concat(n,",\n").concat(o,")")),s.has(e)){var r=s.get(e);if(null==o){var a=r.splice(0,1)[0];s.set(e,r),r.length<=0&&s.delete(e),n=[e,a[0]],t(a[0],n,a[1])}else{for(var l=s.get(e),h=null,c=0;c<l.length;c++)if(l[c][1]==o){h=l.splice(c,1)[0],s.set(e,l),l.length<=0&&s.delete(e);break}if(h)n.push(h[0]),t(h[0],n,h[1]);else{if(n.push(o),i.push(n),!(s.size>0))return;var d=s.keys().next().value,u=s.get(d)[0];t(u[0])}}}else if(o){if(n.push(o),i.push(n),!(s.size>0))return;var f=s.keys().next().value,g=s.get(f)[0];t(g[0])}},o=s.keys().next().value;n(o);var r="",a=new Map,l=function(t){var i=t%(30*e.cols);return{x:i,y:Math.floor((t-i)/e.cols)}};i.forEach((function(t){for(var e=l(t[0]),i={direction:"M",step:0},s="M".concat(e.x," ").concat(e.y),n=1;n<t.length-1;n++){var o=l(t[n]);e.x==o.x?"v"==i.direction?i.step+=o.y-e.y:(0!=i.step&&(s+="".concat(i.direction).concat(i.step)),i.direction="v",i.step=o.y-e.y):"h"==i.direction?i.step+=o.x-e.x:(0!=i.step&&(s+="".concat(i.direction).concat(i.step)),i.direction="h",i.step=o.x-e.x),e.x=o.x,e.y=o.y}s+="z";var r=t[t.length-1];if(a.has(r)){var h=a.get(r);h.push(s),a.set(r,h)}else a.set(r,[s])}));var h,c=(0,Y.Z)(a);try{var d=function(){var t=(0,q.Z)(h.value,2);u=t[0],f=t[1];var e='<path d="';f.forEach((function(t){e+=t})),e+='" fill="'.concat("rgba(0,0,0,255)"==u||"rgba(0,0,1,255)"==u?"currentColor":u,'"/>'),r+=e};for(c.s();!(h=c.n()).done;){var u,f;d()}}catch(g){c.e(g)}finally{c.f()}return console.log(r),r},getSvgContent:function(){for(var t=this.width,e=this.height,i=this.ctx.getImageData(0,0,t,e),s=i.data,n=[],o=0;o<e;o+=this.gridSize)for(var r=0;r<t;r+=this.gridSize){var a=4*(o*t+r),l=s[a],h=s[a+1],c=s[a+2],d=s[a+3];d>0&&n.push({x:r/this.gridSize*this.outputSize,y:o/this.gridSize*this.outputSize,r:l,g:h,b:c,a:d})}var u='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '.concat(this.cols*this.outputSize," ").concat(this.rows*this.outputSize,'">');return u+=this.getpathContent(n),u+="</svg>",u},copySvgCode:function(){var t=this.getSvgContent();this.copyToClipboard(t)},saveAsSvg:function(){var t=this.getSvgContent(),e=new Blob([t],{type:"image/svg+xml"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="drawing.svg",s.click(),URL.revokeObjectURL(i)},saveAsPng:function(){var t=document.createElement("a"),e=this.maincanvas.toDataURL("image/png");t.href=e,t.download="drawing.png",t.click(),URL.revokeObjectURL(e)},saveAsGif:function(){var t=this;if(-1!=this.gifImageDataIndex){var e=this.gifImageDataList,i=new(X())({workers:2,quality:10,workerScript:"".concat({__VUE_PROD_HYDRATION_MISMATCH_DETAILS__:!0}.BASE_URL,"js/gifjs/gif.worker.js"),transparent:"rgba(0,0,0,0)"});e.forEach((function(e){i.addFrame(e,{delay:Math.floor(t.animateSpeed)})})),i.on("finished",(function(t){var e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="output.gif",i.click(),URL.revokeObjectURL(e)})),i.render()}else this.$toast.show("没有创建gif图片数据序列","error")},copyToClipboard:function(t){var e=this;return(0,G.Z)((0,Z.Z)().mark((function i(){return(0,Z.Z)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,navigator.clipboard.writeText(t);case 3:e.$toast.show("复制成功","success"),i.next=9;break;case 6:i.prev=6,i.t0=i["catch"](0),e.$toast.show(i.t0,"error");case 9:case"end":return i.stop()}}),i,null,[[0,6]])})))()},dragViewportDown:function(t){this.$refs.realViewport.removeEventListener("scroll",this.viewportScroll),this.viewport=this.$refs.viewport,this.disx=t.pageX-this.viewport.offsetLeft,this.disy=t.pageY-this.viewport.offsetTop,this.resizeViewport()},dragViewportMove:function(t){if(this.viewport){var e=this.$refs.canvas_overview,i=this.$refs.realViewport,s=e.clientWidth/this.maincanvas.clientWidth,n=t.pageX-this.disx,o=t.pageY-this.disy,r=e.offsetLeft+e.clientWidth-this.viewport.clientWidth-2,a=e.offsetTop+this.viewport.parentElement.clientHeight-this.viewport.clientHeight-2;n=Math.max(e.offsetLeft,Math.min(n,r)),o=Math.max(e.offsetTop,Math.min(o,a)),this.viewport.style.left=n+"px",this.viewport.style.top=o+"px",this.log="".concat(e.offsetLeft);var l=(n-e.offsetLeft)/s,h=(o-e.offsetTop)/s;i.scrollTop=h,i.scrollLeft=l}},dragViewportUp:function(){this.$refs.realViewport.addEventListener("scroll",this.viewportScroll),this.viewport&&(this.viewport=null)},viewportScroll:function(){this.log="".concat(this.$refs.realViewport.scrollTop,",").concat(this.$refs.realViewport.scrollLeft),this.resizeViewport()},zoomWheel:function(t){t.preventDefault();var e=t.deltaY;if(e<0){var i=Number(this.scaleCount)+1;this.scaleCount=Math.min(i,100)}else{i=Number(this.scaleCount)-1;this.scaleCount=Math.max(i,10)}this.resizeViewport()},zoomIn:function(){var t=Number(this.scaleCount)+10;this.scaleCount=Math.min(t,100),this.resizeViewport()},zoomOut:function(){var t=Number(this.scaleCount)-10;this.scaleCount=Math.max(t,10),this.resizeViewport()},zoomFit:function(){this.getMinScale(),this.scaleCount=this.minScaleCount,this.resizeViewport()},resizeViewport:function(){var t=this,e=this.$refs.canvas_overview,i=this.$refs.realViewport,s=e.clientWidth/this.maincanvas.clientWidth;this.$nextTick((function(){var n=i.clientWidth*s,o=i.clientHeight*s;t.$refs.viewport.style.width="".concat(Math.floor(Math.min(n,e.clientWidth)),"px"),t.$refs.viewport.style.height="".concat(Math.floor(Math.min(o,e.clientHeight)-1),"px");var r=t.$refs.canvas_overview.offsetTop+t.$refs.realViewport.scrollTop*s,a=t.$refs.canvas_overview.offsetLeft+t.$refs.realViewport.scrollLeft*s;t.$refs.viewport.style.top="".concat(r,"px"),t.$refs.viewport.style.left="".concat(a,"px")}))},pushGifImgList:function(){var t=this.ctx.getImageData(0,0,this.width,this.height);this.gifImageDataList.splice(this.gifImageDataIndex,0,t),this.gifImageDataIndex++;var e=this;this.$nextTick((function(){for(var t=e.gifImageDataList.length-1;t>e.gifImageDataIndex;t--){var i=e.$refs.gifCanvas[t],s=e.$refs.gifCanvas[t-1],n=i.getContext("2d");n.clearRect(0,0,100*e.cols/e.rows,100),n.drawImage(s,0,0)}var o=e.$refs.gifCanvas[e.gifImageDataIndex],r=o.getContext("2d");r.clearRect(0,0,100*e.cols/e.rows,100),r.drawImage(e.maincanvas,0,0,e.width,e.height,0,0,100*e.cols/e.rows,100)}))},deleteGifImgList:function(){for(var t=this.gifImageDataIndex;t<this.gifImageDataList.length-1;t++){var e=this.$refs.gifCanvas[t],i=this.$refs.gifCanvas[t+1],s=e.getContext("2d");s.clearRect(0,0,100*this.cols/this.rows,100),s.drawImage(i,0,0)}this.gifImageDataList.splice(this.gifImageDataIndex,1),this.gifImageDataIndex>=this.gifImageDataList.length?this.gifImageDataIndex=this.gifImageDataList.length-1:this.gifImageDataList.length<1&&(this.gifImageDataIndex=-1)},startAnimate:function(){0==this.animateId&&this.gifImageDataList.length>0&&(this.animateStartTime=(new Date).getTime(),this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate))},stopAnimate:function(){cancelAnimationFrame(this.animateId),this.animateId=0},updateMainCanvasAnimate:function(){this.ctx.clearRect(0,0,this.width,this.height);var t=this.gifImageDataList[this.gifImageDataIndex];this.ctx.putImageData(t,0,0);var e=(new Date).getTime(),i=e-this.animateStartTime;i>this.animateSpeed&&(this.animateStartTime=e,this.gifImageDataIndex=(this.gifImageDataIndex+1)%this.gifImageDataList.length),this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate)},putGifImage2MainCanvas:function(t){this.stopAnimate(),this.gifImageDataIndex=t;var e=this.gifImageDataList[this.gifImageDataIndex];this.ctx.putImageData(e,0,0),this.addHistory()},updateGifImage:function(t){var e=this,i=this.ctx.getImageData(0,0,this.width,this.height);this.gifImageDataList[t]=i;var s=this;this.$nextTick((function(){var i=s.$refs.gifCanvas[t],n=i.getContext("2d");n.clearRect(0,0,100*e.cols/e.rows,100),n.drawImage(s.maincanvas,0,0,e.width,e.height,0,0,100*e.cols/e.rows,100)}))},changeSpeed:function(t){this.animateFpsIndex=(this.animateFpsIndex+t<0?5:this.animateFpsIndex+t)%6,this.animateSpeed=1e3/this.animateFps[this.animateFpsIndex]},saveGifNPngToFolder:function(t){var e=this;return(0,G.Z)((0,Z.Z)().mark((function i(){var s,n,o,r,a,l,h,c;return(0,Z.Z)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!(t.length<1)){i.next=3;break}return e.$toast.show("没有可以导出的帧","error"),i.abrupt("return");case 3:return s=function(t){return new Promise((function(e){var i=document.createElement("canvas");i.width=t.width,i.height=t.height;var s=i.getContext("2d");s.putImageData(t,0,0),i.toBlob((function(t){e(t)}))}))},i.prev=4,i.next=7,window.showDirectoryPicker();case 7:n=i.sent,o=0;case 9:if(!(o<t.length)){i.next=28;break}return r=t[o],i.next=13,s(r);case 13:return a=i.sent,l="image_".concat(o+1,".png"),i.next=17,n.getFileHandle(l,{create:!0});case 17:return h=i.sent,i.next=20,h.createWritable();case 20:return c=i.sent,i.next=23,c.write(a);case 23:return i.next=25,c.close();case 25:o++,i.next=9;break;case 28:console.log("图片已保存到文件夹中"),i.next=34;break;case 31:i.prev=31,i.t0=i["catch"](4),console.error("保存图片时出错：",i.t0);case 34:case"end":return i.stop()}}),i,null,[[4,31]])})))()},openFileInput:function(){document.getElementById("fileInput").click()},importImg:function(){var t=event.target.files[0],e=this;if(t&&t.type.startsWith("image/")){var i=new FileReader;i.onload=function(t){var i=new Image;i.src=t.target.result,i.onload=function(){e.selectedImgData=null,e.selectedRect={x:0,y:0,width:0,height:0},e.selectedBgData=e.ctx.getImageData(0,0,e.width,e.height),e.offscreenCanvas=document.createElement("canvas");var t=Math.floor(e.height/e.gridSize)*e.gridSize,s=Math.floor(e.height/i.height*i.width/e.gridSize)*e.gridSize;e.offscreenCanvas.width=s,e.offscreenCanvas.height=t;var n=e.offscreenCanvas.getContext("2d");n.drawImage(i,0,0,i.width,i.height,0,0,s,t),e.selectedImgData=n.getImageData(0,0,s,t),0==e.selectRectAnimateId&&(e.selectRectAnimateId=requestAnimationFrame(e.dashedRectAnimate)),e.selectedRect={x:0,y:0,width:s,height:t},e.tool=7}},i.readAsDataURL(t)}else alert("请选择一个有效的图像文件。")},imgToPixel:function(){if(this.offscreenCanvas)for(var t=this.offscreenCanvas.width,e=this.offscreenCanvas.height,i=this.offscreenCanvas.getContext("2d"),s=i.getImageData(0,0,t,e),n=s.data,o=0,r=0,a=0,l=0,h=0,c=0;c<e;c+=this.gridSize)for(var d=0;d<t;d+=this.gridSize){for(var u=0;u<this.gridSize;u++)for(var f=0;f<this.gridSize;f++){var g=4*((c+u)*t+d+f);o+=n[g],r+=n[g+1],a+=n[g+2],l+=n[g+3],h++}o=Math.floor(o/h),r=Math.floor(r/h),a=Math.floor(a/h),l=Math.floor(l/h),i.clearRect(d,c,this.gridSize,this.gridSize),i.fillStyle="rgba(".concat(o,",").concat(r,",").concat(a,",").concat(l,")"),i.fillRect(d,c,this.gridSize,this.gridSize);var p=Math.floor(c/this.gridSize),v=Math.floor(d/this.gridSize);this.imgPointList[p]||(this.imgPointList[p]=[]),this.imgPointList[p][v]=[o,r,a,l],o=0,r=0,a=0,l=0,h=0}},adjustImg:function(){if(this.offscreenCanvas)for(var t=this.offscreenCanvas.getContext("2d"),e=this.processColors(),i=0;i<e.length;i++)for(var s=0;s<e[i].length;s++){var n=(0,q.Z)(e[i][s],4),o=n[0],r=n[1],a=n[2],l=n[3];t.fillStyle="rgba(".concat(o,",").concat(r,",").concat(a,",").concat(l,")"),t.fillRect(s*this.gridSize,i*this.gridSize,this.gridSize,this.gridSize)}},processColors:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.imgPointList,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.threshold,i=[],s=function(t,e){var i=(0,q.Z)(t,4),s=i[0],n=i[1],o=i[2],r=i[3],a=(0,q.Z)(e,4),l=a[0],h=a[1],c=a[2],d=a[3];return Math.sqrt(Math.pow(s-l,2)+Math.pow(n-h,2)+Math.pow(o-c,2)+Math.pow(255*r-255*d,2))},n=function(t,e){var i=(0,q.Z)(t,4),s=i[0],n=i[1],o=i[2],r=i[3],a=(0,q.Z)(e,4),l=a[0],h=a[1],c=a[2],d=a[3];return[Math.round((s+l)/2),Math.round((n+h)/2),Math.round((o+c)/2),Math.round((r+d)/2)]};console.log(t);for(var o=t.length,r=t[0].length,a=JSON.parse(JSON.stringify(t)),l=0;l<o;l++)for(var h=0;h<r;h++){for(var c=t[l][h],d=!1,u=0;u<i.length;u++){var f=i[u];if(s(f,c)<e){var g=n(f,c);a[l][h]=u,console.log(a[l][h]),i[u]=g,console.log("find:".concat(d)),d=u;break}}console.log(d),0==d&&(a[l][h]=i.length,i.push(c))}console.log(i),console.log(a);for(var p=0;p<o;p++)for(var v=0;v<r;v++)a[p][v]=i[a[p][v]];return a}}},et=i(48998);const it=(0,et.Z)(tt,[["render",j],["__scopeId","data-v-d72f48ea"]]);var st=it}}]);
//# sourceMappingURL=199-legacy.eb107bc2.js.map