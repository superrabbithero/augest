{"version":3,"file":"js/3332.04b79a42.js","mappings":"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","sources":["webpack://augest/./src/components/gameDemo/gameDemo.vue","webpack://augest/./src/components/gameDemo/gameDemo.vue?b4ba"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <canvas ref=\"mainCanvas\" width=\"720\" height=\"480\" :class=\"{'game-canvas':true, 'gridsytle':showGrid}\" ></canvas>\n    <div class=\"button-groups\">\n      <div class=\"button-item\">\n        <label>显示网格：</label>\n        <input type=\"checkbox\" v-model=\"showGrid\">\n      </div>\n      <div class=\"button-item\">\n        <label>动画控制：</label>\n        <button class=\"fill\" @click=\"startAnimate\">开始</button>\n        <button class=\"fill\" @click=\"stopAnimate\">停止</button>\n      </div>\n      <div class=\"button-item\">\n        <label>测试方法的按钮：</label>\n        <button class=\"fill\" @click=\"addPopo\">加兔子</button>\n        <button class=\"fill\" @click=\"addPigCoin\">加一个硬币</button>\n      </div>\n      <div class=\"button-item\">\n        <label>方向：</label>\n        <div class=\"dir-contorl\">\n          <div style=\"margin-bottom: 10px;\">\n            <button @click=\"startJump\"><svg-icon name=\"arrow-up\"></svg-icon></button>\n          </div>\n          <div>\n            <button @pointerdown=\"startMove(-1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-left\"></svg-icon></button>  \n            <button><svg-icon name=\"arrow-down\"></svg-icon></button>      \n            <button @pointerdown=\"startMove(1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-right\"></svg-icon></button>\n          </div>\n        </div>\n      </div>\n      <div class=\"button-item log\">\n        速度：{{ Math.abs(moveV.toFixed(2)) }}\n        log:{{ log }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n\n  data(){\n    return {\n      showGrid:true,\n      mainGameData:[],\n      animateId:0,\n      maincanvas:null,\n      ctx:null,\n      srcMap:{},\n      objectMap:{},\n      srcPath:'@/assets/game-img/test/',\n      startX:null,\n      startY:null,\n      jumpTime:null,\n      moveTime:null,\n      moveV:0,\n      moveDir:0,\n      \n      idleFrames:{},//暂时保存一下帧动画\n      currentIdleFrame:0,\n      lastIdleFrameTime:0,\n      idleFrameDuration: 100, \n\n      IdleIndexFlag:false,\n      log:'',\n      objectNewId:0\n    }\n  },\n  created(){\n    this.objectMap = new Map()\n    this.srcMap = new Map()\n    this.idleFrames = new Map()\n    this.loadAllIdleFrames();\n  },\n  mounted(){\n    this.init()\n    window.addEventListener('keydown', this.handleKeyDown)\n    window.addEventListener('keyup', this.handleKeyUp)\n  },\n  unmounted(){\n    window.removeEventListener('keydown', this.handleKeyDown)\n    window.removeEventListener('keyup', this.handleKeyUp)\n  },\n  methods:{\n    test(){\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\n      this.pushObject('coin1','drawing.svg',{x:50,y:50},'pigcoin')\n    },\n    addPopo(){\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\n    },\n    addPigCoin(){\n      const objectId = 'coin' + this.objectNewId++\n      this.log = objectId\n      this.pushObject(objectId,'drawing.svg',{x:(50*this.objectNewId)%600,y:50},'pigcoin')\n    },\n    handleKeyDown(event){\n      console.log(`down:${event.key}`)\n      switch(event.key){\n        case ' ': \n          this.startJump();\n          break;\n        case 'ArrowRight': \n          if(this.moveDir != 1)\n            this.startMove(1) ;\n          break;\n        case 'ArrowLeft':\n          if(this.moveDir != -1) \n            this.startMove(-1) ;\n          break;\n      }\n    },\n    handleKeyUp(event){\n      console.log(`up:${event.key}`)\n      switch(event.key){\n        case 'ArrowRight': \n          this.stopMove() ;\n          break;\n        case 'ArrowLeft': \n          this.stopMove() ;\n          break;\n      }\n    },\n    init(){\n      this.maincanvas = this.$refs.mainCanvas;\n      this.ctx = this.maincanvas.getContext('2d');\n      this.ctx.lineWidth = 1\n    },\n    startMove(dir){\n      this.moveTime = new Date().getTime()\n      this.moveDir = dir\n      console.log(this.moveTime, this.moveDir)\n    },\n    stopMove(){\n      this.moveDir = 0\n      console.log(this.moveTime, this.moveDir)\n    },\n    move(){\n      const starta = this.jumpTime ? 0 : 0.05\n      const fa = this.jumpTime ? 0.001 : 0.01\n      const maxV = 5\n      if(this.moveTime){\n        const t = ((new Date().getTime()-this.moveTime))/100\n        if(this.moveDir > 0){\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\n          this.moveV = Math.min(this.moveV,maxV)\n          let userObject = this.objectMap.get(\"user\")\n          userObject.position.x += this.moveV\n          this.objectMap.set('user', userObject)\n        }else if(this.moveDir < 0){\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\n          this.moveV = Math.max(this.moveV,-maxV)\n          let userObject = this.objectMap.get(\"user\")\n          userObject.position.x += this.moveV\n          \n          this.objectMap.set('user', userObject)\n        }else{\n          if(this.moveV > 0){\n            this.moveV -= fa*t\n            if(this.moveV < 0){\n              this.moveTime = null\n              this.moveV = 0\n            }else{\n              let userObject = this.objectMap.get(\"user\")\n              userObject.position.x += this.moveV\n              this.objectMap.set('user', userObject)\n            }\n          }else{\n            this.moveV += fa*t\n            if(this.moveV > 0){\n              this.moveTime = null\n              this.moveV = 0\n            }else{\n              let userObject = this.objectMap.get(\"user\")\n              userObject.position.x += this.moveV\n              this.objectMap.set('user', userObject)\n            }\n          }\n        }\n        \n\n      }\n      \n      \n    },\n    startJump(){\n      if(!this.jumpTime){\n        this.startY = this.objectMap.get(\"user\").position.y\n        this.jumpTime = new Date().getTime()\n      }\n    },\n    jump(){\n      const v = -100 //跳跃初速度\n      const a = 10 //重力加速度\n      let userObject = this.objectMap.get(\"user\")\n      const y1 = this.startY\n      const t = ((new Date().getTime()-this.jumpTime))/100\n      const y = y1 + v*t + a * t * t\n      if(y > y1){\n        userObject.position.y = y1\n        this.objectMap.set('user', userObject)\n        this.jumpTime = null\n      }else{\n        userObject.position.y = y\n        this.objectMap.set('user', userObject)\n      }\n    },\n\n    pushObject(id,url,position,name){\n      if(this.srcMap.has(url)){\n        this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\n      }else{\n        this.getImage(url).then((rs)=>{\n          // console.log(rs)\n          this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\n        }).catch((err)=>{\n          // console.log(err)\n        })\n      }\n    },\n    deleteObject(id){\n      this.objectMap.delete(id)\n    },\n    startAnimate(){\n      if(this.animateId == 0){\n        this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\n      }\n    },\n    stopAnimate(){\n      cancelAnimationFrame(this.animateId)\n      this.animateId = 0\n    },\n    updateMainCanvasAnimate(timestamp){\n      \n      const userObject = this.objectMap.get('user')\n      const userFramesList = this.idleFrames.get(userObject.name)[userObject.animationName]\n      //位移必须得实时刷新\n      if(this.jumpTime){\n        this.jump()\n      }\n      this.move()\n        \n      \n      //刷新帧动画\n      if(timestamp - this.lastIdleFrameTime > this.idleFrameDuration){\n        this.ctx.clearRect(0,0,720,480)\n        \n        \n        this.objectMap.forEach((value, key) => {\n          const idleFramesList = this.idleFrames.get(value.name)[value.animationName]\n          if(value.name == 'paopao'){\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,160,160)\n          }else{\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,75,75)\n            this.log = `${value.animationIndex},${idleFramesList.length}`\n          }\n          value.animationIndex = (value.animationIndex+1)%(idleFramesList.length)\n          this.objectMap.set(key,value)\n        })\n        // this.IdleIndexFlag = false\n        this.lastIdleFrameTime = timestamp;\n      }\n        \n      \n\n\n      this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\n    },\n    async getImage(url) {\n      if(url.split('.').slice(-1)[0] == 'svg'){\n        // 加载SVG图像\n        const svgResponse = await fetch(require(`@/assets/game-img/test/${url}`));\n        const svgText = await svgResponse.text();\n        const svgDoc = new DOMParser().parseFromString(svgText, \"image/svg+xml\");\n        const svgElement = svgDoc.querySelector('svg');\n        const svgData = new XMLSerializer().serializeToString(svgElement);\n        const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n        const svgUrl = URL.createObjectURL(svgBlob);\n        const svgImg = new Image();\n        const that = this\n        svgImg.onload = function() {\n          that.srcMap.set(url, svgImg); \n          URL.revokeObjectURL(svgUrl);\n        };\n        svgImg.src = svgUrl;\n      }else{\n        // 加载PNG图像\n        const pngImg = new Image();\n        const that = this\n        pngImg.onload = function() {\n          that.srcMap.set(url, pngImg) \n        };\n        pngImg.src = require(`@/assets/game-img/test/${url}`); \n      }\n    },\n    loadAllIdleFrames(callback) {\n      const context = require.context('@/assets/game-img/test/animation/', true, /\\.png$/);\n\n      context.keys().forEach((key) => {\n        // 使用正则表达式从路径中提取 objectName 和 animateName\n        const pathMatch = key.match(/\\.\\/([^/]+)\\/([^/]+)\\/.+\\.png$/);\n        if (pathMatch) {\n          const objectName = pathMatch[1];\n          const animateName = pathMatch[2];\n\n          if (!this.idleFrames.has(objectName)) {\n            this.idleFrames.set(objectName, {});\n          }\n          const objectIdles = this.idleFrames.get(objectName);\n          \n          if (!objectIdles[animateName]) {\n            objectIdles[animateName] = [];\n          }\n\n          const img = new Image();\n          img.onload = () => {\n            objectIdles[animateName].push(img);\n          };\n          img.src = context(key);\n\n          this.idleFrames.set(objectName, objectIdles);\n        }\n      });\n\n      if (callback) callback();\n    }\n\n  }\n\n}\n  \n</script>\n\n<style scoped>\n  .container{\n    height: calc(100vh - 125px);\n  }\n\n  .game-canvas{\n    border: var(--box-border);\n    width: 720px;\n    height: 480px;\n    \n  }\n\n  .gridsytle{\n    background: linear-gradient(\n        -45deg,\n        #d9d9d9 25%,\n        transparent 25%,\n        transparent 75%,\n        #d9d9d9 75%,\n        #d9d9d9 100%\n      ),\n      linear-gradient(\n        -45deg,\n        #d9d9d9 25%,\n        transparent 25%,\n        transparent 75%,\n        #d9d9d9 75%,\n        #d9d9d9 100%\n      );\n    background-size: 10px 10px;\n    background-position: 0px 0px, 5px 5px;\n    background-color: white;\n  }\n\n  .button-groups {\n    width: 720px;\n    display: flex;\n    flex-wrap: wrap;\n    /* justify-content: center; */\n  }\n\n  .button-item{\n    margin: 10px;\n    display: flex;\n    align-items: center;\n  }\n  .button-item.log{\n    width: 100%;\n  }\n  .button-item button{\n    margin-right:10px;\n  }\n\n  .dir-contorl button{\n    padding: 5px;\n  }\n</style>\n\n","import { render } from \"./gameDemo.vue?vue&type=template&id=e4b463d4&scoped=true\"\nimport script from \"./gameDemo.vue?vue&type=script&lang=js\"\nexport * from \"./gameDemo.vue?vue&type=script&lang=js\"\n\nimport \"./gameDemo.vue?vue&type=style&index=0&id=e4b463d4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-e4b463d4\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","style","_createElementBlock","_hoisted_1","ref","width","height","_normalizeClass","$data","showGrid","_hoisted_2","_hoisted_3","_hoisted_4","type","$event","_hoisted_5","_hoisted_6","onClick","_cache","args","$options","startAnimate","stopAnimate","_hoisted_7","_hoisted_8","addPopo","addPigCoin","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","startJump","_createVNode","_component_svg_icon","name","onPointerdown","startMove","onPointerup","stopMove","onPointerleave","_hoisted_13","_toDisplayString","Math","abs","moveV","toFixed","log","data","mainGameData","animateId","maincanvas","ctx","srcMap","objectMap","srcPath","startX","startY","jumpTime","moveTime","moveDir","idleFrames","currentIdleFrame","lastIdleFrameTime","idleFrameDuration","IdleIndexFlag","objectNewId","created","this","Map","loadAllIdleFrames","mounted","init","window","addEventListener","handleKeyDown","handleKeyUp","unmounted","removeEventListener","methods","test","pushObject","x","y","objectId","event","console","key","$refs","mainCanvas","getContext","lineWidth","dir","Date","getTime","move","starta","fa","maxV","t","min","userObject","get","position","set","max","jump","v","a","y1","id","url","has","animationName","animationIndex","getImage","then","rs","catch","err","deleteObject","delete","requestAnimationFrame","updateMainCanvasAnimate","cancelAnimationFrame","timestamp","clearRect","forEach","value","idleFramesList","drawImage","length","split","slice","svgResponse","fetch","require","svgText","text","svgDoc","DOMParser","parseFromString","svgElement","querySelector","svgData","XMLSerializer","serializeToString","svgBlob","Blob","svgUrl","URL","createObjectURL","svgImg","Image","that","onload","revokeObjectURL","src","pngImg","callback","context","keys","pathMatch","match","objectName","animateName","objectIdles","img","push","__exports__","render"],"sourceRoot":""}