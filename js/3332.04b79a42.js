"use strict";(self["webpackChunkaugest"]=self["webpackChunkaugest"]||[]).push([[3332],{3332:function(e,t,i){i.r(t),i.d(t,{default:function(){return f}});var s=i(9812),a=i(5893),o=i(4220);const n=e=>((0,s.dD)("data-v-e4b463d4"),e=e(),(0,s.Cn)(),e),m={class:"container"},r={class:"button-groups"},h={class:"button-item"},l=n((()=>(0,s._)("label",null,"显示网格：",-1))),c={class:"button-item"},d=n((()=>(0,s._)("label",null,"动画控制：",-1))),p={class:"button-item"},u=n((()=>(0,s._)("label",null,"测试方法的按钮：",-1))),v={class:"button-item"},g=n((()=>(0,s._)("label",null,"方向：",-1))),b={class:"dir-contorl"},w={style:{"margin-bottom":"10px"}},M={class:"button-item log"};function j(e,t,i,n,j,x){const I=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("canvas",{ref:"mainCanvas",width:"720",height:"480",class:(0,a.C_)({"game-canvas":!0,gridsytle:j.showGrid})},null,2),(0,s._)("div",r,[(0,s._)("div",h,[l,(0,s.wy)((0,s._)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>j.showGrid=e)},null,512),[[o.e8,j.showGrid]])]),(0,s._)("div",c,[d,(0,s._)("button",{class:"fill",onClick:t[1]||(t[1]=(...e)=>x.startAnimate&&x.startAnimate(...e))},"开始"),(0,s._)("button",{class:"fill",onClick:t[2]||(t[2]=(...e)=>x.stopAnimate&&x.stopAnimate(...e))},"停止")]),(0,s._)("div",p,[u,(0,s._)("button",{class:"fill",onClick:t[3]||(t[3]=(...e)=>x.addPopo&&x.addPopo(...e))},"加兔子"),(0,s._)("button",{class:"fill",onClick:t[4]||(t[4]=(...e)=>x.addPigCoin&&x.addPigCoin(...e))},"加一个硬币")]),(0,s._)("div",v,[g,(0,s._)("div",b,[(0,s._)("div",w,[(0,s._)("button",{onClick:t[5]||(t[5]=(...e)=>x.startJump&&x.startJump(...e))},[(0,s.Wm)(I,{name:"arrow-up"})])]),(0,s._)("div",null,[(0,s._)("button",{onPointerdown:t[6]||(t[6]=e=>x.startMove(-1)),onPointerup:t[7]||(t[7]=(...e)=>x.stopMove&&x.stopMove(...e)),onPointerleave:t[8]||(t[8]=(...e)=>x.stopMove&&x.stopMove(...e))},[(0,s.Wm)(I,{name:"arrow-left"})],32),(0,s._)("button",null,[(0,s.Wm)(I,{name:"arrow-down"})]),(0,s._)("button",{onPointerdown:t[9]||(t[9]=e=>x.startMove(1)),onPointerup:t[10]||(t[10]=(...e)=>x.stopMove&&x.stopMove(...e)),onPointerleave:t[11]||(t[11]=(...e)=>x.stopMove&&x.stopMove(...e))},[(0,s.Wm)(I,{name:"arrow-right"})],32)])])]),(0,s._)("div",M," 速度："+(0,a.zw)(Math.abs(j.moveV.toFixed(2)))+" log:"+(0,a.zw)(j.log),1)])])}i(6229),i(7330),i(2062),i(7658);var x={data(){return{showGrid:!0,mainGameData:[],animateId:0,maincanvas:null,ctx:null,srcMap:{},objectMap:{},srcPath:"@/assets/game-img/test/",startX:null,startY:null,jumpTime:null,moveTime:null,moveV:0,moveDir:0,idleFrames:{},currentIdleFrame:0,lastIdleFrameTime:0,idleFrameDuration:100,IdleIndexFlag:!1,log:"",objectNewId:0}},created(){this.objectMap=new Map,this.srcMap=new Map,this.idleFrames=new Map,this.loadAllIdleFrames()},mounted(){this.init(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)},unmounted(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)},methods:{test(){this.pushObject("user","drawing.svg",{x:50,y:320},"paopao"),this.pushObject("coin1","drawing.svg",{x:50,y:50},"pigcoin")},addPopo(){this.pushObject("user","drawing.svg",{x:50,y:320},"paopao")},addPigCoin(){const e="coin"+this.objectNewId++;this.log=e,this.pushObject(e,"drawing.svg",{x:50*this.objectNewId%600,y:50},"pigcoin")},handleKeyDown(e){switch(console.log(`down:${e.key}`),e.key){case" ":this.startJump();break;case"ArrowRight":1!=this.moveDir&&this.startMove(1);break;case"ArrowLeft":-1!=this.moveDir&&this.startMove(-1);break}},handleKeyUp(e){switch(console.log(`up:${e.key}`),e.key){case"ArrowRight":this.stopMove();break;case"ArrowLeft":this.stopMove();break}},init(){this.maincanvas=this.$refs.mainCanvas,this.ctx=this.maincanvas.getContext("2d"),this.ctx.lineWidth=1},startMove(e){this.moveTime=(new Date).getTime(),this.moveDir=e,console.log(this.moveTime,this.moveDir)},stopMove(){this.moveDir=0,console.log(this.moveTime,this.moveDir)},move(){const e=this.jumpTime?0:.05,t=this.jumpTime?.001:.01,i=5;if(this.moveTime){const s=((new Date).getTime()-this.moveTime)/100;if(this.moveDir>0){this.moveV=this.moveV+this.moveDir*(e-t)*s,this.moveV=Math.min(this.moveV,i);let a=this.objectMap.get("user");a.position.x+=this.moveV,this.objectMap.set("user",a)}else if(this.moveDir<0){this.moveV=this.moveV+this.moveDir*(e-t)*s,this.moveV=Math.max(this.moveV,-i);let a=this.objectMap.get("user");a.position.x+=this.moveV,this.objectMap.set("user",a)}else if(this.moveV>0)if(this.moveV-=t*s,this.moveV<0)this.moveTime=null,this.moveV=0;else{let e=this.objectMap.get("user");e.position.x+=this.moveV,this.objectMap.set("user",e)}else if(this.moveV+=t*s,this.moveV>0)this.moveTime=null,this.moveV=0;else{let e=this.objectMap.get("user");e.position.x+=this.moveV,this.objectMap.set("user",e)}}},startJump(){this.jumpTime||(this.startY=this.objectMap.get("user").position.y,this.jumpTime=(new Date).getTime())},jump(){const e=-100,t=10;let i=this.objectMap.get("user");const s=this.startY,a=((new Date).getTime()-this.jumpTime)/100,o=s+e*a+t*a*a;o>s?(i.position.y=s,this.objectMap.set("user",i),this.jumpTime=null):(i.position.y=o,this.objectMap.set("user",i))},pushObject(e,t,i,s){this.srcMap.has(t)?this.objectMap.set(e,{url:t,position:i,animationName:"idle01",animationIndex:0,name:s}):this.getImage(t).then((a=>{this.objectMap.set(e,{url:t,position:i,animationName:"idle01",animationIndex:0,name:s})})).catch((e=>{}))},deleteObject(e){this.objectMap.delete(e)},startAnimate(){0==this.animateId&&(this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate))},stopAnimate(){cancelAnimationFrame(this.animateId),this.animateId=0},updateMainCanvasAnimate(e){const t=this.objectMap.get("user");this.idleFrames.get(t.name)[t.animationName];this.jumpTime&&this.jump(),this.move(),e-this.lastIdleFrameTime>this.idleFrameDuration&&(this.ctx.clearRect(0,0,720,480),this.objectMap.forEach(((e,t)=>{const i=this.idleFrames.get(e.name)[e.animationName];"paopao"==e.name?this.ctx.drawImage(i[e.animationIndex],e.position.x,e.position.y,160,160):(this.ctx.drawImage(i[e.animationIndex],e.position.x,e.position.y,75,75),this.log=`${e.animationIndex},${i.length}`),e.animationIndex=(e.animationIndex+1)%i.length,this.objectMap.set(t,e)})),this.lastIdleFrameTime=e),this.animateId=requestAnimationFrame(this.updateMainCanvasAnimate)},async getImage(e){if("svg"==e.split(".").slice(-1)[0]){const t=await fetch(i(5603)(`./${e}`)),s=await t.text(),a=(new DOMParser).parseFromString(s,"image/svg+xml"),o=a.querySelector("svg"),n=(new XMLSerializer).serializeToString(o),m=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(m),h=new Image,l=this;h.onload=function(){l.srcMap.set(e,h),URL.revokeObjectURL(r)},h.src=r}else{const t=new Image,s=this;t.onload=function(){s.srcMap.set(e,t)},t.src=i(5603)(`./${e}`)}},loadAllIdleFrames(e){const t=i(6329);t.keys().forEach((e=>{const i=e.match(/\.\/([^/]+)\/([^/]+)\/.+\.png$/);if(i){const s=i[1],a=i[2];this.idleFrames.has(s)||this.idleFrames.set(s,{});const o=this.idleFrames.get(s);o[a]||(o[a]=[]);const n=new Image;n.onload=()=>{o[a].push(n)},n.src=t(e),this.idleFrames.set(s,o)}})),e&&e()}}},I=i(8998);const y=(0,I.Z)(x,[["render",j],["__scopeId","data-v-e4b463d4"]]);var f=y}}]);
//# sourceMappingURL=3332.04b79a42.js.map