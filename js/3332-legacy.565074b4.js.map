{"version":3,"file":"js/3332-legacy.565074b4.js","mappings":"+QACOA,MAAM,a,GAEJA,MAAM,iB,GACJA,MAAM,e,uBACTC,EAAAA,EAAAA,GAAoB,aAAb,SAAK,M,GAGTD,MAAM,e,uBACTC,EAAAA,EAAAA,GAAoB,aAAb,SAAK,M,GAITD,MAAM,e,uBACTC,EAAAA,EAAAA,GAAuB,aAAhB,YAAQ,M,GAIZD,MAAM,e,uBACTC,EAAAA,EAAAA,GAAkB,aAAX,OAAG,M,GACLD,MAAM,e,GACJE,MAAA,0B,GAUJF,MAAM,mB,qEA9BfG,EAAAA,EAAAA,IAmCM,MAnCNC,EAmCM,EAlCJH,EAAAA,EAAAA,GAAgH,UAAxGI,IAAI,aAAaC,MAAM,MAAMC,OAAO,MAAOP,OAAKQ,EAAAA,EAAAA,IAAA,4BAAmCC,EAAAC,Y,SAC3FT,EAAAA,EAAAA,GAgCM,MAhCNU,EAgCM,EA/BJV,EAAAA,EAAAA,GAGM,MAHNW,EAGM,CAFJC,GAAoB,SACpBZ,EAAAA,EAAAA,GAA0C,SAAnCa,KAAK,W,qDAAoBL,EAAAC,SAAQK,CAAA,I,iBAARN,EAAAC,eAElCT,EAAAA,EAAAA,GAIM,MAJNe,EAIM,CAHJC,GACAhB,EAAAA,EAAAA,GAAsD,UAA9CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,qBAAEC,EAAAC,cAAAD,EAAAC,aAAAC,MAAAF,EAAAG,UAAY,IAAE,OAC3CtB,EAAAA,EAAAA,GAAqD,UAA7CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,qBAAEC,EAAAI,aAAAJ,EAAAI,YAAAF,MAAAF,EAAAG,UAAW,IAAE,SAE5CtB,EAAAA,EAAAA,GAIM,MAJNwB,EAIM,CAHJC,GACAzB,EAAAA,EAAAA,GAAkD,UAA1CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,qBAAEC,EAAAO,SAAAP,EAAAO,QAAAL,MAAAF,EAAAG,UAAO,IAAE,QACtCtB,EAAAA,EAAAA,GAAuD,UAA/CD,MAAM,OAAQkB,QAAKC,EAAA,KAAAA,EAAA,qBAAEC,EAAAQ,YAAAR,EAAAQ,WAAAN,MAAAF,EAAAG,UAAU,IAAE,YAE3CtB,EAAAA,EAAAA,GAYM,MAZN4B,EAYM,CAXJC,GACA7B,EAAAA,EAAAA,GASM,MATN8B,EASM,EARJ9B,EAAAA,EAAAA,GAEM,MAFN+B,EAEM,EADJ/B,EAAAA,EAAAA,GAAyE,UAAhEiB,QAAKC,EAAA,KAAAA,EAAA,qBAAEC,EAAAa,WAAAb,EAAAa,UAAAX,MAAAF,EAAAG,UAAS,I,EAAEW,EAAAA,EAAAA,IAAqCC,EAAA,CAA3BC,KAAK,kBAE5CnC,EAAAA,EAAAA,GAIM,aAHJA,EAAAA,EAAAA,GAAoI,UAA3HoC,cAAWlB,EAAA,KAAAA,EAAA,YAAAJ,GAAA,OAAEK,EAAAkB,WAAW,EAAF,GAAOC,YAASpB,EAAA,KAAAA,EAAA,qBAAEC,EAAAoB,UAAApB,EAAAoB,SAAAlB,MAAAF,EAAAG,UAAQ,GAAGkB,eAAYtB,EAAA,KAAAA,EAAA,qBAAEC,EAAAoB,UAAApB,EAAAoB,SAAAlB,MAAAF,EAAAG,UAAQ,I,EAAEW,EAAAA,EAAAA,IAAuCC,EAAA,CAA7BC,KAAK,gBAAY,KAC/GnC,EAAAA,EAAAA,GAAwD,gBAAhDiC,EAAAA,EAAAA,IAAuCC,EAAA,CAA7BC,KAAK,kBACvBnC,EAAAA,EAAAA,GAAoI,UAA3HoC,cAAWlB,EAAA,KAAAA,EAAA,YAAAJ,GAAA,OAAEK,EAAAkB,UAAU,EAAD,GAAMC,YAASpB,EAAA,MAAAA,EAAA,sBAAEC,EAAAoB,UAAApB,EAAAoB,SAAAlB,MAAAF,EAAAG,UAAQ,GAAGkB,eAAYtB,EAAA,MAAAA,EAAA,sBAAEC,EAAAoB,UAAApB,EAAAoB,SAAAlB,MAAAF,EAAAG,UAAQ,I,EAAEW,EAAAA,EAAAA,IAAwCC,EAAA,CAA9BC,KAAK,iBAAa,WAIrHnC,EAAAA,EAAAA,GAGM,MAHNyC,EAA6B,QACxBC,EAAAA,EAAAA,IAAGC,KAAKC,IAAIpC,EAAAqC,MAAMC,QAAQ,KAAM,SAC/BJ,EAAAA,EAAAA,IAAGlC,EAAAuC,KAAG,M,2BAOlB,G,+IAAA,CAEEC,KAAI,WACF,MAAO,CACLvC,UAAS,EACTwC,aAAa,GACbC,UAAU,EACVC,WAAW,KACXC,IAAI,KACJC,OAAO,CAAC,EACRC,UAAU,CAAC,EACXC,QAAQ,0BACRC,OAAO,KACPC,OAAO,KACPC,SAAS,KACTC,SAAS,KACTd,MAAM,EACNe,QAAQ,EAERC,WAAW,CAAC,EACZC,iBAAiB,EACjBC,kBAAkB,EAClBC,kBAAmB,IAEnBC,eAAc,EACdlB,IAAI,GACJmB,YAAY,EAEhB,EACAC,QAAO,WACLC,KAAKd,UAAY,IAAIe,IACrBD,KAAKf,OAAS,IAAIgB,IAClBD,KAAKP,WAAa,IAAIQ,IACtBD,KAAKE,mBACP,EACAC,QAAO,WACLH,KAAKI,OACLC,OAAOC,iBAAiB,UAAWN,KAAKO,eACxCF,OAAOC,iBAAiB,QAASN,KAAKQ,YACxC,EACAC,UAAS,WACPJ,OAAOK,oBAAoB,UAAWV,KAAKO,eAC3CF,OAAOK,oBAAoB,QAASV,KAAKQ,YAC3C,EACAG,QAAQ,CACNC,KAAI,WACFZ,KAAKa,WAAW,OAAO,cAAc,CAACC,EAAE,GAAGC,EAAE,KAAK,UAClDf,KAAKa,WAAW,QAAQ,cAAc,CAACC,EAAE,GAAGC,EAAE,IAAI,UACpD,EACAzD,QAAO,WACL0C,KAAKa,WAAW,OAAO,cAAc,CAACC,EAAE,GAAGC,EAAE,KAAK,SACpD,EACAxD,WAAU,WACR,IAAMyD,EAAW,OAAShB,KAAKF,cAC/BE,KAAKrB,IAAMqC,EACXhB,KAAKa,WAAWG,EAAS,cAAc,CAACF,EAAG,GAAGd,KAAKF,YAAa,IAAIiB,EAAE,IAAI,UAC5E,EACAR,cAAa,SAACU,GAEZ,OADAC,QAAQvC,IAAI,QAADwC,OAASF,EAAMG,MACnBH,EAAMG,KACX,IAAK,IACHpB,KAAKpC,YACL,MACF,IAAK,aACgB,GAAhBoC,KAAKR,SACNQ,KAAK/B,UAAU,GACjB,MACF,IAAK,aACiB,GAAjB+B,KAAKR,SACNQ,KAAK/B,WAAW,GAClB,MAEN,EACAuC,YAAW,SAACS,GAEV,OADAC,QAAQvC,IAAI,MAADwC,OAAOF,EAAMG,MACjBH,EAAMG,KACX,IAAK,aACHpB,KAAK7B,WACL,MACF,IAAK,YACH6B,KAAK7B,WACL,MAEN,EACAiC,KAAI,WACFJ,KAAKjB,WAAaiB,KAAKqB,MAAMC,WAC7BtB,KAAKhB,IAAMgB,KAAKjB,WAAWwC,WAAW,MACtCvB,KAAKhB,IAAIwC,UAAY,CACvB,EACAvD,UAAS,SAACwD,GACRzB,KAAKT,UAAW,IAAImC,MAAOC,UAC3B3B,KAAKR,QAAUiC,EACfP,QAAQvC,IAAIqB,KAAKT,SAAUS,KAAKR,QAClC,EACArB,SAAQ,WACN6B,KAAKR,QAAU,EACf0B,QAAQvC,IAAIqB,KAAKT,SAAUS,KAAKR,QAClC,EACAoC,KAAI,WACF,IAAMC,EAAS7B,KAAKV,SAAW,EAAI,IAC7BwC,EAAK9B,KAAKV,SAAW,KAAQ,IAC7ByC,EAAO,EACb,GAAG/B,KAAKT,SAAS,CACf,IAAMyC,IAAM,IAAIN,MAAOC,UAAU3B,KAAKT,UAAW,IACjD,GAAGS,KAAKR,QAAU,EAAE,CAClBQ,KAAKvB,MAAQuB,KAAKvB,MAAQuB,KAAKR,SAASqC,EAASC,GAAIE,EACrDhC,KAAKvB,MAAQF,KAAK0D,IAAIjC,KAAKvB,MAAMsD,GACjC,IAAIG,EAAalC,KAAKd,UAAUiD,IAAI,QACpCD,EAAWE,SAAStB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUmD,IAAI,OAAQH,EAC7B,MAAM,GAAGlC,KAAKR,QAAU,EAAE,CACxBQ,KAAKvB,MAAQuB,KAAKvB,MAAQuB,KAAKR,SAASqC,EAASC,GAAIE,EACrDhC,KAAKvB,MAAQF,KAAK+D,IAAItC,KAAKvB,OAAOsD,GAClC,IAAIG,EAAalC,KAAKd,UAAUiD,IAAI,QACpCD,EAAWE,SAAStB,GAAKd,KAAKvB,MAE9BuB,KAAKd,UAAUmD,IAAI,OAAQH,EAC7B,MACE,GAAGlC,KAAKvB,MAAQ,EAEd,GADAuB,KAAKvB,OAASqD,EAAGE,EACdhC,KAAKvB,MAAQ,EACduB,KAAKT,SAAW,KAChBS,KAAKvB,MAAQ,MACV,CACH,IAAIyD,EAAalC,KAAKd,UAAUiD,IAAI,QACpCD,EAAWE,SAAStB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUmD,IAAI,OAAQH,EAC7B,MAGA,GADAlC,KAAKvB,OAASqD,EAAGE,EACdhC,KAAKvB,MAAQ,EACduB,KAAKT,SAAW,KAChBS,KAAKvB,MAAQ,MACV,CACH,IAAIyD,EAAalC,KAAKd,UAAUiD,IAAI,QACpCD,EAAWE,SAAStB,GAAKd,KAAKvB,MAC9BuB,KAAKd,UAAUmD,IAAI,OAAQH,EAC7B,CAKN,CAGF,EACAtE,UAAS,WACHoC,KAAKV,WACPU,KAAKX,OAASW,KAAKd,UAAUiD,IAAI,QAAQC,SAASrB,EAClDf,KAAKV,UAAW,IAAIoC,MAAOC,UAE/B,EACAY,KAAI,WACF,IAAMC,GAAK,IACLC,EAAI,GACNP,EAAalC,KAAKd,UAAUiD,IAAI,QAC9BO,EAAK1C,KAAKX,OACV2C,IAAM,IAAIN,MAAOC,UAAU3B,KAAKV,UAAW,IAC3CyB,EAAI2B,EAAKF,EAAER,EAAIS,EAAIT,EAAIA,EAC1BjB,EAAI2B,GACLR,EAAWE,SAASrB,EAAI2B,EACxB1C,KAAKd,UAAUmD,IAAI,OAAQH,GAC3BlC,KAAKV,SAAW,OAEhB4C,EAAWE,SAASrB,EAAIA,EACxBf,KAAKd,UAAUmD,IAAI,OAAQH,GAE/B,EAEArB,WAAU,SAAC8B,EAAGC,EAAIR,EAASrE,GAAK,IAAA8E,EAAA,KAC3B7C,KAAKf,OAAO6D,IAAIF,GACjB5C,KAAKd,UAAUmD,IAAIM,EAAG,CAACC,IAAAA,EAAIR,SAAAA,EAASW,cAAc,SAASC,eAAe,EAAEjF,KAAAA,IAE5EiC,KAAKiD,SAASL,GAAKM,MAAK,SAACC,GAEvBN,EAAK3D,UAAUmD,IAAIM,EAAG,CAACC,IAAAA,EAAIR,SAAAA,EAASW,cAAc,SAASC,eAAe,EAAEjF,KAAAA,GAC9E,IAAGqF,OAAM,SAACC,GACR,GAGN,EACAC,aAAY,SAACX,GACX3C,KAAKd,UAAUqE,OAAOZ,EACxB,EACA3F,aAAY,WACW,GAAlBgD,KAAKlB,YACNkB,KAAKlB,UAAY0E,sBAAsBxD,KAAKyD,yBAEhD,EACAtG,YAAW,WACTuG,qBAAqB1D,KAAKlB,WAC1BkB,KAAKlB,UAAY,CACnB,EACA2E,wBAAuB,SAACE,GAAU,IAAAC,EAAA,KAE1B1B,EAAalC,KAAKd,UAAUiD,IAAI,QACfnC,KAAKP,WAAW0C,IAAID,EAAWnE,MAAMmE,EAAWa,eAEpE/C,KAAKV,UACNU,KAAKuC,OAEPvC,KAAK4B,OAIF+B,EAAY3D,KAAKL,kBAAoBK,KAAKJ,oBAC3CI,KAAKhB,IAAI6E,UAAU,EAAE,EAAE,IAAI,KAG3B7D,KAAKd,UAAU4E,SAAQ,SAACC,EAAO3C,GAC7B,IAAM4C,EAAiBJ,EAAKnE,WAAW0C,IAAI4B,EAAMhG,MAAMgG,EAAMhB,eAC5C,UAAdgB,EAAMhG,KACP6F,EAAK5E,IAAIiF,UAAUD,EAAeD,EAAMf,gBAAgBe,EAAM3B,SAAStB,EAAEiD,EAAM3B,SAASrB,EAAE,IAAI,MAE9F6C,EAAK5E,IAAIiF,UAAUD,EAAeD,EAAMf,gBAAgBe,EAAM3B,SAAStB,EAAEiD,EAAM3B,SAASrB,EAAE,GAAG,IAC7F6C,EAAKjF,IAAE,GAAAwC,OAAO4C,EAAMf,eAAc,KAAA7B,OAAI6C,EAAeE,SAEvDH,EAAMf,gBAAkBe,EAAMf,eAAe,GAAIgB,EAAeE,OAChEN,EAAK1E,UAAUmD,IAAIjB,EAAI2C,EACzB,IAEA/D,KAAKL,kBAAoBgE,GAM3B3D,KAAKlB,UAAY0E,sBAAsBxD,KAAKyD,wBAC9C,EACMR,SAAQ,SAACL,GAAK,IAAAuB,EAAA,YAAAC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAA,SAAAC,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAb,EAAAA,EAAAA,KAAAc,MAAA,SAAAC,GAAA,eAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACgB,OAA/B1C,EAAI2C,MAAM,KAAKC,OAAO,GAAG,GAAW,CAAAJ,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EAEXG,MAAMC,EAAAA,MAAAA,CAAQ,KAADvE,OAA2ByB,KAAO,OAAzD,OAAV4B,EAAUY,EAAAO,KAAAP,EAAAE,KAAA,EACMd,EAAYoB,OAAM,OAAlCnB,EAAMW,EAAAO,KACNjB,GAAS,IAAImB,WAAYC,gBAAgBrB,EAAS,iBAClDE,EAAaD,EAAOqB,cAAc,OAClCnB,GAAU,IAAIoB,eAAgBC,kBAAkBtB,GAChDE,EAAU,IAAIqB,KAAK,CAACtB,GAAU,CAAEnI,KAAM,gCACtCqI,EAASqB,IAAIC,gBAAgBvB,GAC7BE,EAAS,IAAIsB,MACbrB,EAAOb,EACbY,EAAOuB,OAAS,WACdtB,EAAK/F,OAAOoD,IAAIO,EAAKmC,GACrBoB,IAAII,gBAAgBzB,EACtB,EACAC,EAAOyB,IAAM1B,EAAMM,EAAAE,KAAA,iBAGbL,EAAS,IAAIoB,MACbrB,EAAOb,EACbc,EAAOqB,OAAS,WACdtB,EAAK/F,OAAOoD,IAAIO,EAAKqC,EACvB,EACAA,EAAOuB,IAAMd,EAAAA,MAAAA,CAAQ,KAADvE,OAA2ByB,IAAM,yBAAAwC,EAAAqB,OAAA,GAAAlC,EAAA,IAxBrCH,EA0BpB,EACAlE,kBAAiB,SAACwG,GAAU,IAAAC,EAAA,KACpBC,EAAUlB,EAAAA,OAEhBkB,EAAQC,OAAO/C,SAAQ,SAAC1C,GAEtB,IAAM0F,EAAY1F,EAAI2F,MAAM,kCAC5B,GAAID,EAAW,CACb,IAAME,EAAaF,EAAU,GACvBG,EAAcH,EAAU,GAEzBH,EAAKlH,WAAWqD,IAAIkE,IACvBL,EAAKlH,WAAW4C,IAAI2E,EAAY,CAAC,GAEnC,IAAME,EAAcP,EAAKlH,WAAW0C,IAAI6E,GAEnCE,EAAYD,KACfC,EAAYD,GAAe,IAG7B,IAAME,EAAM,IAAId,MAChBc,EAAIb,OAAS,WACXY,EAAYD,GAAaG,KAAKD,EAChC,EACAA,EAAIX,IAAMI,EAAQxF,GAElBuF,EAAKlH,WAAW4C,IAAI2E,EAAYE,EAClC,CACF,IAEIR,GAAUA,GAChB,K,WC/TJ,MAAMW,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,O","sources":["webpack://augest/./src/components/gameDemo/gameDemo.vue","webpack://augest/./src/components/gameDemo/gameDemo.vue?b4ba"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <canvas ref=\"mainCanvas\" width=\"720\" height=\"480\" :class=\"{'game-canvas':true, 'gridsytle':showGrid}\" ></canvas>\n    <div class=\"button-groups\">\n      <div class=\"button-item\">\n        <label>显示网格：</label>\n        <input type=\"checkbox\" v-model=\"showGrid\">\n      </div>\n      <div class=\"button-item\">\n        <label>动画控制：</label>\n        <button class=\"fill\" @click=\"startAnimate\">开始</button>\n        <button class=\"fill\" @click=\"stopAnimate\">停止</button>\n      </div>\n      <div class=\"button-item\">\n        <label>测试方法的按钮：</label>\n        <button class=\"fill\" @click=\"addPopo\">加兔子</button>\n        <button class=\"fill\" @click=\"addPigCoin\">加一个硬币</button>\n      </div>\n      <div class=\"button-item\">\n        <label>方向：</label>\n        <div class=\"dir-contorl\">\n          <div style=\"margin-bottom: 10px;\">\n            <button @click=\"startJump\"><svg-icon name=\"arrow-up\"></svg-icon></button>\n          </div>\n          <div>\n            <button @pointerdown=\"startMove(-1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-left\"></svg-icon></button>  \n            <button><svg-icon name=\"arrow-down\"></svg-icon></button>      \n            <button @pointerdown=\"startMove(1)\" @pointerup=\"stopMove\" @pointerleave=\"stopMove\"><svg-icon name=\"arrow-right\"></svg-icon></button>\n          </div>\n        </div>\n      </div>\n      <div class=\"button-item log\">\n        速度：{{ Math.abs(moveV.toFixed(2)) }}\n        log:{{ log }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n\n  data(){\n    return {\n      showGrid:true,\n      mainGameData:[],\n      animateId:0,\n      maincanvas:null,\n      ctx:null,\n      srcMap:{},\n      objectMap:{},\n      srcPath:'@/assets/game-img/test/',\n      startX:null,\n      startY:null,\n      jumpTime:null,\n      moveTime:null,\n      moveV:0,\n      moveDir:0,\n      \n      idleFrames:{},//暂时保存一下帧动画\n      currentIdleFrame:0,\n      lastIdleFrameTime:0,\n      idleFrameDuration: 100, \n\n      IdleIndexFlag:false,\n      log:'',\n      objectNewId:0\n    }\n  },\n  created(){\n    this.objectMap = new Map()\n    this.srcMap = new Map()\n    this.idleFrames = new Map()\n    this.loadAllIdleFrames();\n  },\n  mounted(){\n    this.init()\n    window.addEventListener('keydown', this.handleKeyDown)\n    window.addEventListener('keyup', this.handleKeyUp)\n  },\n  unmounted(){\n    window.removeEventListener('keydown', this.handleKeyDown)\n    window.removeEventListener('keyup', this.handleKeyUp)\n  },\n  methods:{\n    test(){\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\n      this.pushObject('coin1','drawing.svg',{x:50,y:50},'pigcoin')\n    },\n    addPopo(){\n      this.pushObject('user','drawing.svg',{x:50,y:320},'paopao')\n    },\n    addPigCoin(){\n      const objectId = 'coin' + this.objectNewId++\n      this.log = objectId\n      this.pushObject(objectId,'drawing.svg',{x:(50*this.objectNewId)%600,y:50},'pigcoin')\n    },\n    handleKeyDown(event){\n      console.log(`down:${event.key}`)\n      switch(event.key){\n        case ' ': \n          this.startJump();\n          break;\n        case 'ArrowRight': \n          if(this.moveDir != 1)\n            this.startMove(1) ;\n          break;\n        case 'ArrowLeft':\n          if(this.moveDir != -1) \n            this.startMove(-1) ;\n          break;\n      }\n    },\n    handleKeyUp(event){\n      console.log(`up:${event.key}`)\n      switch(event.key){\n        case 'ArrowRight': \n          this.stopMove() ;\n          break;\n        case 'ArrowLeft': \n          this.stopMove() ;\n          break;\n      }\n    },\n    init(){\n      this.maincanvas = this.$refs.mainCanvas;\n      this.ctx = this.maincanvas.getContext('2d');\n      this.ctx.lineWidth = 1\n    },\n    startMove(dir){\n      this.moveTime = new Date().getTime()\n      this.moveDir = dir\n      console.log(this.moveTime, this.moveDir)\n    },\n    stopMove(){\n      this.moveDir = 0\n      console.log(this.moveTime, this.moveDir)\n    },\n    move(){\n      const starta = this.jumpTime ? 0 : 0.05\n      const fa = this.jumpTime ? 0.001 : 0.01\n      const maxV = 5\n      if(this.moveTime){\n        const t = ((new Date().getTime()-this.moveTime))/100\n        if(this.moveDir > 0){\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\n          this.moveV = Math.min(this.moveV,maxV)\n          let userObject = this.objectMap.get(\"user\")\n          userObject.position.x += this.moveV\n          this.objectMap.set('user', userObject)\n        }else if(this.moveDir < 0){\n          this.moveV = this.moveV + this.moveDir*(starta - fa)*t\n          this.moveV = Math.max(this.moveV,-maxV)\n          let userObject = this.objectMap.get(\"user\")\n          userObject.position.x += this.moveV\n          \n          this.objectMap.set('user', userObject)\n        }else{\n          if(this.moveV > 0){\n            this.moveV -= fa*t\n            if(this.moveV < 0){\n              this.moveTime = null\n              this.moveV = 0\n            }else{\n              let userObject = this.objectMap.get(\"user\")\n              userObject.position.x += this.moveV\n              this.objectMap.set('user', userObject)\n            }\n          }else{\n            this.moveV += fa*t\n            if(this.moveV > 0){\n              this.moveTime = null\n              this.moveV = 0\n            }else{\n              let userObject = this.objectMap.get(\"user\")\n              userObject.position.x += this.moveV\n              this.objectMap.set('user', userObject)\n            }\n          }\n        }\n        \n\n      }\n      \n      \n    },\n    startJump(){\n      if(!this.jumpTime){\n        this.startY = this.objectMap.get(\"user\").position.y\n        this.jumpTime = new Date().getTime()\n      }\n    },\n    jump(){\n      const v = -100 //跳跃初速度\n      const a = 10 //重力加速度\n      let userObject = this.objectMap.get(\"user\")\n      const y1 = this.startY\n      const t = ((new Date().getTime()-this.jumpTime))/100\n      const y = y1 + v*t + a * t * t\n      if(y > y1){\n        userObject.position.y = y1\n        this.objectMap.set('user', userObject)\n        this.jumpTime = null\n      }else{\n        userObject.position.y = y\n        this.objectMap.set('user', userObject)\n      }\n    },\n\n    pushObject(id,url,position,name){\n      if(this.srcMap.has(url)){\n        this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\n      }else{\n        this.getImage(url).then((rs)=>{\n          // console.log(rs)\n          this.objectMap.set(id,{url,position,animationName:\"idle01\",animationIndex:0,name})\n        }).catch((err)=>{\n          // console.log(err)\n        })\n      }\n    },\n    deleteObject(id){\n      this.objectMap.delete(id)\n    },\n    startAnimate(){\n      if(this.animateId == 0){\n        this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\n      }\n    },\n    stopAnimate(){\n      cancelAnimationFrame(this.animateId)\n      this.animateId = 0\n    },\n    updateMainCanvasAnimate(timestamp){\n      \n      const userObject = this.objectMap.get('user')\n      const userFramesList = this.idleFrames.get(userObject.name)[userObject.animationName]\n      //位移必须得实时刷新\n      if(this.jumpTime){\n        this.jump()\n      }\n      this.move()\n        \n      \n      //刷新帧动画\n      if(timestamp - this.lastIdleFrameTime > this.idleFrameDuration){\n        this.ctx.clearRect(0,0,720,480)\n        \n        \n        this.objectMap.forEach((value, key) => {\n          const idleFramesList = this.idleFrames.get(value.name)[value.animationName]\n          if(value.name == 'paopao'){\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,160,160)\n          }else{\n            this.ctx.drawImage(idleFramesList[value.animationIndex],value.position.x,value.position.y,75,75)\n            this.log = `${value.animationIndex},${idleFramesList.length}`\n          }\n          value.animationIndex = (value.animationIndex+1)%(idleFramesList.length)\n          this.objectMap.set(key,value)\n        })\n        // this.IdleIndexFlag = false\n        this.lastIdleFrameTime = timestamp;\n      }\n        \n      \n\n\n      this.animateId = requestAnimationFrame(this.updateMainCanvasAnimate)\n    },\n    async getImage(url) {\n      if(url.split('.').slice(-1)[0] == 'svg'){\n        // 加载SVG图像\n        const svgResponse = await fetch(require(`@/assets/game-img/test/${url}`));\n        const svgText = await svgResponse.text();\n        const svgDoc = new DOMParser().parseFromString(svgText, \"image/svg+xml\");\n        const svgElement = svgDoc.querySelector('svg');\n        const svgData = new XMLSerializer().serializeToString(svgElement);\n        const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n        const svgUrl = URL.createObjectURL(svgBlob);\n        const svgImg = new Image();\n        const that = this\n        svgImg.onload = function() {\n          that.srcMap.set(url, svgImg); \n          URL.revokeObjectURL(svgUrl);\n        };\n        svgImg.src = svgUrl;\n      }else{\n        // 加载PNG图像\n        const pngImg = new Image();\n        const that = this\n        pngImg.onload = function() {\n          that.srcMap.set(url, pngImg) \n        };\n        pngImg.src = require(`@/assets/game-img/test/${url}`); \n      }\n    },\n    loadAllIdleFrames(callback) {\n      const context = require.context('@/assets/game-img/test/animation/', true, /\\.png$/);\n\n      context.keys().forEach((key) => {\n        // 使用正则表达式从路径中提取 objectName 和 animateName\n        const pathMatch = key.match(/\\.\\/([^/]+)\\/([^/]+)\\/.+\\.png$/);\n        if (pathMatch) {\n          const objectName = pathMatch[1];\n          const animateName = pathMatch[2];\n\n          if (!this.idleFrames.has(objectName)) {\n            this.idleFrames.set(objectName, {});\n          }\n          const objectIdles = this.idleFrames.get(objectName);\n          \n          if (!objectIdles[animateName]) {\n            objectIdles[animateName] = [];\n          }\n\n          const img = new Image();\n          img.onload = () => {\n            objectIdles[animateName].push(img);\n          };\n          img.src = context(key);\n\n          this.idleFrames.set(objectName, objectIdles);\n        }\n      });\n\n      if (callback) callback();\n    }\n\n  }\n\n}\n  \n</script>\n\n<style scoped>\n  .container{\n    height: calc(100vh - 125px);\n  }\n\n  .game-canvas{\n    border: var(--box-border);\n    width: 720px;\n    height: 480px;\n    \n  }\n\n  .gridsytle{\n    background: linear-gradient(\n        -45deg,\n        #d9d9d9 25%,\n        transparent 25%,\n        transparent 75%,\n        #d9d9d9 75%,\n        #d9d9d9 100%\n      ),\n      linear-gradient(\n        -45deg,\n        #d9d9d9 25%,\n        transparent 25%,\n        transparent 75%,\n        #d9d9d9 75%,\n        #d9d9d9 100%\n      );\n    background-size: 10px 10px;\n    background-position: 0px 0px, 5px 5px;\n    background-color: white;\n  }\n\n  .button-groups {\n    width: 720px;\n    display: flex;\n    flex-wrap: wrap;\n    /* justify-content: center; */\n  }\n\n  .button-item{\n    margin: 10px;\n    display: flex;\n    align-items: center;\n  }\n  .button-item.log{\n    width: 100%;\n  }\n  .button-item button{\n    margin-right:10px;\n  }\n\n  .dir-contorl button{\n    padding: 5px;\n  }\n</style>\n\n","import { render } from \"./gameDemo.vue?vue&type=template&id=e4b463d4&scoped=true\"\nimport script from \"./gameDemo.vue?vue&type=script&lang=js\"\nexport * from \"./gameDemo.vue?vue&type=script&lang=js\"\n\nimport \"./gameDemo.vue?vue&type=style&index=0&id=e4b463d4&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-e4b463d4\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","style","_createElementBlock","_hoisted_1","ref","width","height","_normalizeClass","$data","showGrid","_hoisted_2","_hoisted_3","_hoisted_4","type","$event","_hoisted_5","_hoisted_6","onClick","_cache","$options","startAnimate","apply","arguments","stopAnimate","_hoisted_7","_hoisted_8","addPopo","addPigCoin","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","startJump","_createVNode","_component_svg_icon","name","onPointerdown","startMove","onPointerup","stopMove","onPointerleave","_hoisted_13","_toDisplayString","Math","abs","moveV","toFixed","log","data","mainGameData","animateId","maincanvas","ctx","srcMap","objectMap","srcPath","startX","startY","jumpTime","moveTime","moveDir","idleFrames","currentIdleFrame","lastIdleFrameTime","idleFrameDuration","IdleIndexFlag","objectNewId","created","this","Map","loadAllIdleFrames","mounted","init","window","addEventListener","handleKeyDown","handleKeyUp","unmounted","removeEventListener","methods","test","pushObject","x","y","objectId","event","console","concat","key","$refs","mainCanvas","getContext","lineWidth","dir","Date","getTime","move","starta","fa","maxV","t","min","userObject","get","position","set","max","jump","v","a","y1","id","url","_this","has","animationName","animationIndex","getImage","then","rs","catch","err","deleteObject","delete","requestAnimationFrame","updateMainCanvasAnimate","cancelAnimationFrame","timestamp","_this2","clearRect","forEach","value","idleFramesList","drawImage","length","_this3","_asyncToGenerator","_regeneratorRuntime","mark","_callee","svgResponse","svgText","svgDoc","svgElement","svgData","svgBlob","svgUrl","svgImg","that","pngImg","_that","wrap","_context","prev","next","split","slice","fetch","require","sent","text","DOMParser","parseFromString","querySelector","XMLSerializer","serializeToString","Blob","URL","createObjectURL","Image","onload","revokeObjectURL","src","stop","callback","_this4","context","keys","pathMatch","match","objectName","animateName","objectIdles","img","push","__exports__","render"],"sourceRoot":""}